<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Codex Pro API</title>
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800&family=Rajdhani:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" onerror="this.onerror=null;this.href='https://unpkg.com/prismjs@1.29.0/themes/prism-tomorrow.min.css'">
  <style>
    :root {
      --bg: #050508;
      --bg-elevated: #0a0a12;
      --surface: #0d0d18;
      --surface-soft: #12121f;
      --surface-hover: #1a1a2e;
      --border: rgba(0,245,255,0.12);
      --border-strong: rgba(0,245,255,0.25);
      --text: #e8e8f0;
      --text-muted: #8892a8;
      --accent: #00f5ff;
      --accent-hover: #5cffff;
      --accent-muted: rgba(0,245,255,0.15);
      --accent-soft: rgba(0,245,255,0.06);
      --neon-pink: #ff00ff;
      --neon-pink-muted: rgba(255,0,255,0.2);
      --neon-yellow: #ffb800;
      --danger: #ff3366;
      --danger-muted: rgba(255,51,102,0.2);
      --success: #00ff88;
      --success-muted: rgba(0,255,136,0.15);
      --radius-sm: 4px;
      --radius: 6px;
      --radius-lg: 8px;
      --radius-xl: 10px;
      --shadow: 0 8px 32px rgba(0,0,0,0.5);
      --shadow-sm: 0 2px 16px rgba(0,0,0,0.3);
      --shadow-glow: 0 0 40px rgba(0,245,255,0.15), 0 0 80px rgba(0,245,255,0.05);
      --glow-cyan: 0 0 20px rgba(0,245,255,0.4);
      --font-display: 'Orbitron', sans-serif;
      --font-body: 'Rajdhani', system-ui, sans-serif;
    }
    * { box-sizing: border-box; }
    :focus-visible { outline: 2px solid var(--accent); outline-offset: 2px; box-shadow: 0 0 12px var(--accent-muted); }
    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after { animation-duration: 0.01ms !important; transition-duration: 0.01ms !important; }
    }
    body {
      font-family: var(--font-body);
      background: var(--bg);
      color: var(--text);
      margin: 0;
      min-height: 100vh;
      font-size: 16px;
      line-height: 1.5;
      font-weight: 500;
      -webkit-font-smoothing: antialiased;
      position: relative;
      overflow-x: hidden;
    }
    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background:
        linear-gradient(180deg, transparent 0%, rgba(0,245,255,0.02) 50%, transparent 100%),
        radial-gradient(ellipse 120% 80% at 20% 10%, rgba(0,245,255,0.08) 0%, transparent 50%),
        radial-gradient(ellipse 80% 120% at 80% 90%, rgba(255,0,255,0.05) 0%, transparent 50%),
        repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,245,255,0.02) 2px, rgba(0,245,255,0.02) 4px);
      background-size: 100% 100%, 200% 200%, 200% 200%, 100% 4px;
      animation: codexBgShift 20s ease-in-out infinite;
      pointer-events: none;
      z-index: 0;
    }
    @keyframes codexBgShift {
      0%, 100% { opacity: 1; background-position: 0 0, 0% 50%, 100% 50%, 0 0; }
      50% { opacity: 0.95; background-position: 0 0, 100% 50%, 0% 50%, 0 0; }
    }
    body::after {
      content: '';
      position: fixed;
      inset: 0;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.04'/%3E%3C/svg%3E");
      pointer-events: none;
      z-index: 0;
    }
    .sidebar, .right-col { position: relative; z-index: 1; }
    .sidebar {
      position: fixed;
      left: 0;
      top: 0;
      bottom: 0;
      width: 268px;
      background: linear-gradient(180deg, rgba(10,10,18,0.98) 0%, rgba(5,5,8,0.99) 100%);
      backdrop-filter: blur(16px);
      border-right: 1px solid var(--border);
      box-shadow: 4px 0 24px rgba(0,245,255,0.06);
      padding: 28px 0;
      display: flex;
      flex-direction: column;
      overflow-y: auto;
    }
    .logo {
      display: flex;
      align-items: center;
      gap: 14px;
      padding: 0 22px 22px;
      margin-bottom: 12px;
      border-bottom: 1px solid var(--border);
    }
    .logo-icon {
      width: 44px;
      height: 44px;
      background: linear-gradient(135deg, var(--accent) 0%, #0088aa 100%);
      border: 1px solid rgba(0,245,255,0.5);
      border-radius: var(--radius);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 800;
      font-size: 14px;
      font-family: var(--font-display);
      color: #000;
      text-shadow: 0 0 10px rgba(0,245,255,0.8);
      box-shadow: 0 0 24px rgba(0,245,255,0.4), inset 0 1px 0 rgba(255,255,255,0.3);
      animation: logoGlow 3s ease-in-out infinite;
    }
    @keyframes logoGlow {
      0%, 100% { box-shadow: 0 0 24px rgba(0,245,255,0.4), inset 0 1px 0 rgba(255,255,255,0.3); }
      50% { box-shadow: 0 0 32px rgba(0,245,255,0.6), inset 0 1px 0 rgba(255,255,255,0.4); }
    }
    .logo-text { font-family: var(--font-display); font-weight: 700; font-size: 18px; letter-spacing: 0.08em; color: var(--text); text-shadow: 0 0 20px rgba(0,245,255,0.3); }
    .logo-sub { font-size: 11px; color: var(--text-muted); margin-top: 3px; font-weight: 600; letter-spacing: 0.12em; text-transform: uppercase; }
    .menu-label {
      font-family: var(--font-display);
      font-size: 10px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.2em;
      color: var(--text-muted);
      padding: 16px 20px 8px;
    }
    .menu a {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px 20px;
      margin: 0 8px;
      color: var(--text-muted);
      text-decoration: none;
      border-radius: var(--radius-sm);
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      border-left: 2px solid transparent;
      transition: color 0.2s ease, background 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease;
    }
    .menu a:hover {
      color: var(--accent);
      background: var(--accent-soft);
      border-left-color: var(--accent);
      box-shadow: inset 0 0 20px rgba(0,245,255,0.05);
    }
    .menu a.active {
      color: var(--accent);
      background: var(--accent-muted);
      border-left-color: var(--accent);
      box-shadow: inset 0 0 24px rgba(0,245,255,0.1), 0 0 20px rgba(0,245,255,0.08);
    }
    .sidebar-footer {
      margin-top: auto;
      padding: 16px 20px 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      border-top: 1px solid var(--border);
    }
    .sidebar-footer a {
      color: var(--text-muted);
      font-size: 13px;
      font-weight: 600;
      text-decoration: none;
      transition: color 0.15s, text-shadow 0.15s;
    }
    .sidebar-footer a:hover { color: var(--accent); text-shadow: 0 0 12px var(--accent-muted); }
    .sidebar-footer .footer-recommend { display: block; margin-bottom: 8px; font-size: 12px; color: var(--accent); text-align: center; line-height: 1.4; }
    .sidebar-footer .footer-github {
      display: inline-flex; align-items: center; justify-content: center;
      width: 32px; height: 32px; border-radius: 4px;
      border: 1px solid var(--border);
      color: var(--text-muted); transition: color 0.15s, border-color 0.15s, box-shadow 0.15s;
    }
    .sidebar-footer .footer-github:hover { color: var(--accent); border-color: var(--accent); box-shadow: 0 0 12px var(--accent-muted); }
    .sidebar-footer .footer-github svg { width: 20px; height: 20px; fill: currentColor; }
    .right-col {
      margin-left: 260px;
      flex: 1;
      display: flex;
      flex-direction: column;
      min-width: 0;
      min-height: 100vh;
    }
    .topbar {
      position: sticky;
      top: 0;
      z-index: 2;
      flex-shrink: 0;
      height: 60px;
      padding: 0 28px;
      border-bottom: 1px solid var(--border);
      background: rgba(10,10,18,0.92);
      backdrop-filter: blur(16px);
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 2px 24px rgba(0,0,0,0.4), 0 1px 0 rgba(0,245,255,0.08);
    }
    .topbar-title { font-family: var(--font-display); font-weight: 700; font-size: 16px; letter-spacing: 0.05em; color: var(--text); }
    .topbar-sub { font-size: 10px; color: var(--text-muted); margin-top: 2px; letter-spacing: 0.12em; opacity: 0.85; }
    .topbar-status {
      display: flex;
      align-items: center;
      gap: 14px;
    }
    .topbar-status .dot {
      width: 8px; height: 8px; border-radius: 50%;
      background: var(--accent);
      box-shadow: 0 0 10px var(--accent), 0 0 0 2px rgba(0,245,255,0.25);
      animation: statusPulse 2s ease-in-out infinite;
    }
    @keyframes statusPulse {
      0%, 100% { opacity: 1; transform: scale(1); box-shadow: 0 0 10px var(--accent), 0 0 0 2px rgba(0,245,255,0.25); }
      50% { opacity: 0.9; transform: scale(1.1); box-shadow: 0 0 16px var(--accent), 0 0 0 2px rgba(0,245,255,0.4); }
    }
    .topbar-status .label { font-size: 12px; font-weight: 600; color: var(--text-muted); letter-spacing: 0.04em; }
    .btn-icon {
      width: 36px; height: 36px;
      border: 1px solid transparent; background: transparent; color: var(--text-muted);
      border-radius: var(--radius-sm); cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      font-size: 18px;
      transition: color 0.2s ease, background 0.2s ease, transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease;
    }
    .btn-icon:hover { background: var(--accent-soft); color: var(--accent); border-color: var(--border-strong); box-shadow: 0 0 16px rgba(0,245,255,0.15); transform: rotate(90deg); }
    .btn-icon-text { width: auto; padding: 0 10px; font-size: 12px; }
    .btn-icon-text:hover { transform: none; }
    #btnRefresh {
      padding: 8px 16px;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      font-weight: 500;
    }
    #btnRefresh:hover { border-color: var(--accent); color: var(--accent); }
    .main {
      flex: 1;
      min-height: 0;
      min-width: 0;
      width: 100%;
      padding: 32px 40px 48px;
      overflow-y: auto;
    }
    .view {
      display: none;
      animation: viewFadeIn 0.35s ease-out;
    }
    .view.active { display: block; }
    @keyframes viewFadeIn {
      from { opacity: 0; transform: translateY(8px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .page-header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      margin-bottom: 28px;
      flex-wrap: wrap;
      gap: 16px;
      padding-bottom: 20px;
      border-bottom: 1px solid var(--border);
    }
    .page-title {
      font-family: var(--font-display);
      font-size: 26px;
      font-weight: 700;
      letter-spacing: 0.06em;
      margin: 0 0 8px 0;
      color: var(--text);
      text-shadow: 0 0 30px rgba(0,245,255,0.15);
    }
    .page-subtitle {
      font-family: var(--font-display);
      font-size: 10px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.22em;
      color: var(--text-muted);
      opacity: 0.9;
    }
    .page-live {
      font-size: 13px;
      color: var(--accent);
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 14px;
      background: var(--accent-soft);
      border: 1px solid var(--border);
      border-radius: var(--radius);
    }
    .page-live .dot {
      width: 6px; height: 6px; border-radius: 50%;
      background: var(--accent);
      box-shadow: 0 0 8px var(--accent);
      animation: liveDot 2s ease-in-out infinite;
    }
    @keyframes liveDot {
      0%, 100% { opacity: 1; box-shadow: 0 0 8px var(--accent); }
      50% { opacity: 0.85; box-shadow: 0 0 12px var(--accent); }
    }
    .search-input {
      width: 100%;
      max-width: 260px;
      padding: 10px 14px 10px 38px;
      background: var(--bg-elevated);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      color: var(--text);
      font-size: 14px;
      font-weight: 500;
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
    }
    .search-input:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 2px var(--accent-muted), 0 0 20px rgba(0,245,255,0.12);
    }
    .search-wrap { position: relative; }
    .search-wrap::before {
      content: '';
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      width: 14px;
      height: 14px;
      border: 2px solid var(--text-muted);
      border-radius: 50%;
      opacity: 0.5;
    }
    .search-wrap::after {
      content: '';
      position: absolute;
      left: 22px;
      top: 52%;
      width: 6px;
      height: 2px;
      background: var(--text-muted);
      transform: rotate(45deg);
      opacity: 0.5;
    }
    .section-card {
      background: linear-gradient(180deg, var(--surface-soft) 0%, var(--surface) 100%);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      padding: 28px 30px;
      margin-bottom: 28px;
      box-shadow: inset 0 1px 0 rgba(0,245,255,0.05), 0 4px 24px rgba(0,0,0,0.15);
      transition: border-color 0.25s ease, box-shadow 0.25s ease;
    }
    .section-card:hover { box-shadow: 0 0 28px rgba(0,245,255,0.06), inset 0 1px 0 rgba(0,245,255,0.08); border-color: var(--border-strong); }
    .section-card h3 {
      font-family: var(--font-display);
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: var(--text-muted);
      margin: 0 0 20px 0;
      padding-bottom: 14px;
      border-bottom: 1px solid var(--border);
    }
    .logs-list { margin: 0; padding: 0; list-style: none; }
    .logs-table { width: 100%; border-collapse: collapse; font-size: 13px; font-family: monospace; }
    .logs-table th, .logs-table td {
      padding: 10px 12px;
      border-bottom: 1px solid var(--border);
      text-align: left;
      white-space: nowrap;
    }
    .logs-table .log-time { color: var(--text-muted); min-width: 160px; }
    .logs-table .log-method { color: var(--accent); font-weight: 700; min-width: 64px; text-shadow: 0 0 10px var(--accent-muted); }
    .logs-table .log-path { color: var(--text); min-width: 100px; }
    .logs-table .log-account { color: var(--text-muted); min-width: 80px; }
    .logs-table .log-status { color: var(--success); min-width: 56px; }
    .logs-table .log-status.error { color: var(--danger); }
    .logs-table .log-ms { color: var(--text-muted); font-size: 12px; min-width: 56px; }
    .logs-table thead th { font-weight: 600; color: var(--text-muted); }
    .logs-table tr.log-row-system td { background: var(--bg-elevated); color: var(--text-muted); }
    .logs-toolbar { display: flex; align-items: center; gap: 12px; flex-wrap: wrap; margin-bottom: 12px; }
    .logs-level-filters { display: flex; align-items: center; gap: 16px; flex-wrap: wrap; }
    .logs-level-filters label { display: flex; align-items: center; gap: 6px; cursor: pointer; font-size: 12px; font-weight: 600; color: var(--text-muted); user-select: none; }
    .logs-level-filters input { margin: 0; }
    .log-badge { display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: 10px; font-weight: 700; text-transform: uppercase; min-width: 52px; text-align: center; }
    .log-badge.info { background: var(--accent-muted); color: var(--accent); box-shadow: 0 0 10px rgba(0,245,255,0.2); }
    .log-badge.success { background: var(--success-muted); color: var(--success); box-shadow: 0 0 10px rgba(0,255,136,0.2); }
    .log-badge.warn { background: rgba(255,184,0,0.2); color: var(--neon-yellow); box-shadow: 0 0 10px rgba(255,184,0,0.2); }
    .log-badge.err { background: var(--danger-muted); color: #ff6b8a; box-shadow: 0 0 10px rgba(255,51,102,0.2); }
    .log-entries { font-family: monospace; font-size: 13px; max-height: 60vh; overflow-y: auto; border: 1px solid var(--border); border-radius: var(--radius); background: var(--bg-elevated); }
    .log-entry { display: flex; align-items: flex-start; gap: 12px; padding: 10px 14px; border-bottom: 1px solid var(--border); line-height: 1.45; transition: background 0.15s ease; }
    .log-entry:nth-child(even) { background: rgba(255,255,255,0.02); }
    .log-entry:hover { background: var(--accent-soft); box-shadow: inset 2px 0 0 var(--accent); }
    .log-entry:last-child { border-bottom: none; }
    .log-entry .log-time { color: var(--text-muted); flex-shrink: 0; width: 72px; }
    .log-entry .log-level { flex-shrink: 0; }
    .log-entry .log-msg { color: var(--text); word-break: break-word; min-width: 0; }
    .logs-placeholder {
      text-align: center;
      padding: 48px 24px;
      color: var(--text-muted);
      font-size: 14px;
    }
    .settings-tabs {
      display: flex;
      gap: 4px;
      margin-bottom: 24px;
      border-bottom: 1px solid var(--border);
    }
    .settings-tabs button {
      padding: 10px 16px;
      border: none;
      background: transparent;
      color: var(--text-muted);
      font-size: 14px;
      font-weight: 500;
      font-family: inherit;
      cursor: pointer;
      border-bottom: 2px solid transparent;
      margin-bottom: -1px;
      transition: color 0.15s, border-color 0.15s;
    }
    .settings-tabs button:hover { color: var(--text); }
    .settings-tabs button.active { color: var(--accent); border-bottom-color: var(--accent); }
    .settings-panel { display: none; }
    .settings-panel.active { display: block; }
    .settings-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 24px;
      max-width: 720px;
    }
    @media (min-width: 720px) {
      .settings-grid { grid-template-columns: 1fr 1fr; }
    }
    .settings-section-title {
      font-family: var(--font-display);
      font-size: 11px;
      font-weight: 700;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      color: var(--accent);
      margin: 0 0 12px 0;
      padding-bottom: 6px;
      border-bottom: 1px solid var(--border);
    }
    .settings-url-block {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px 14px;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      font-family: var(--font-display);
      font-size: 13px;
      letter-spacing: 0.04em;
      color: var(--text);
      margin-bottom: 10px;
    }
    .settings-url-block code { flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    .btn-copy {
      flex-shrink: 0;
      padding: 6px 12px;
      font-size: 12px;
      font-weight: 600;
      color: var(--accent);
      background: var(--accent-soft);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      cursor: pointer;
      transition: color 0.2s, background 0.2s, border-color 0.2s;
    }
    .btn-copy:hover { background: var(--accent-muted); border-color: var(--accent); color: var(--text); }
    .settings-model-pill {
      display: inline-block;
      padding: 6px 12px;
      background: var(--surface-hover);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      font-family: var(--font-display);
      font-size: 12px;
      color: var(--accent);
      margin-top: 8px;
    }
    .settings-quick-links {
      list-style: none;
      margin: 0;
      padding: 0;
    }
    .settings-quick-links li { margin-bottom: 0; }
    .settings-quick-links a {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 0;
      color: var(--text-muted);
      text-decoration: none;
      font-size: 14px;
      font-weight: 500;
      border-bottom: 1px solid var(--border);
      transition: color 0.2s;
    }
    .settings-quick-links a:last-child { border-bottom: none; }
    .settings-quick-links a:hover { color: var(--accent); }
    .settings-quick-links .link-icon {
      width: 20px;
      height: 20px;
      flex-shrink: 0;
      opacity: 0.8;
    }
    .settings-about {
      padding: 16px;
      background: var(--surface-soft);
      border-radius: var(--radius);
      border: 1px solid var(--border);
      font-size: 13px;
      color: var(--text-muted);
    }
    .settings-about .ver { font-family: var(--font-display); font-weight: 700; color: var(--accent); margin-right: 8px; }
    .badge { display: inline-block; padding: 2px 8px; border-radius: 6px; font-size: 11px; font-weight: 600; }
    .badge-oauth { background: var(--accent-muted); color: var(--accent); }
    .badge-manual { background: var(--surface-hover); color: var(--text-muted); }
    .cards {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
      gap: 24px;
      margin-bottom: 36px;
      width: 100%;
    }
    .card {
      background: linear-gradient(165deg, var(--surface) 0%, var(--surface-soft) 100%);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      padding: 28px 30px;
      box-shadow: inset 0 1px 0 rgba(0,245,255,0.05), 0 4px 20px rgba(0,0,0,0.2);
      transition: border-color 0.2s ease, box-shadow 0.2s ease, transform 0.2s ease;
    }
    .card:hover {
      border-color: var(--accent);
      box-shadow: 0 0 32px rgba(0,245,255,0.1), inset 0 1px 0 rgba(0,245,255,0.08);
      transform: translateY(-2px);
    }
    .card .label {
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--text-muted);
      margin-bottom: 10px;
    }
    .card .value {
      font-family: var(--font-display);
      font-size: 32px;
      font-weight: 700;
      letter-spacing: 0.04em;
      color: var(--text);
      line-height: 1.2;
      text-shadow: 0 0 20px rgba(0,245,255,0.08);
    }
    .card .hint {
      font-size: 12px;
      color: var(--text-muted);
      margin-top: 12px;
      line-height: 1.45;
    }
    .table-wrap {
      background: linear-gradient(180deg, var(--surface) 0%, var(--surface-soft) 100%);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      overflow: hidden;
      box-shadow: 0 4px 24px rgba(0,0,0,0.3), inset 0 1px 0 rgba(0,245,255,0.05);
      transition: box-shadow 0.25s ease, border-color 0.2s ease;
    }
    .table-wrap:hover { box-shadow: 0 0 28px rgba(0,245,255,0.1), inset 0 1px 0 rgba(0,245,255,0.08); border-color: var(--border-strong); }
    .table-wrap table { width: 100%; border-collapse: collapse; }
    .table-wrap th, .table-wrap td {
      padding: 14px 20px;
      text-align: left;
      border-bottom: 1px solid var(--border);
    }
    .table-wrap th {
      font-family: var(--font-display);
      font-size: 10px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      color: var(--text-muted);
      background: var(--surface-soft);
    }
    .field-highlight {
      background: var(--accent-soft);
      box-shadow: inset 0 0 0 1px var(--border);
    }
    .table-wrap th.field-highlight { background: var(--surface-soft); box-shadow: inset 0 0 0 1px var(--border-strong); }
    .table-wrap th, .table-wrap td {
      background: var(--accent-soft);
      box-shadow: inset 0 0 0 1px rgba(0,245,255,0.06);
    }
    .table-wrap th { background: var(--surface-soft); box-shadow: inset 0 0 0 1px var(--border); }
    .page-title { border-bottom: 1px solid var(--border); padding-bottom: 8px; }
    .section-card { box-shadow: var(--shadow-sm), inset 0 1px 0 rgba(0,245,255,0.06); }
    .search-input, .search-wrap input, input[type="text"], input[type="url"] { box-shadow: inset 0 0 0 1px var(--border); }
    .search-input:focus, .search-wrap input:focus { box-shadow: inset 0 0 0 2px var(--accent), 0 0 16px rgba(0,245,255,0.15); border-color: var(--accent); }
    .table-wrap tbody tr {
      transition: background 0.2s ease, transform 0.15s ease;
    }
    .table-wrap tbody tr:hover {
      background: var(--surface-hover);
    }
    .table-wrap tr:last-child td { border-bottom: none; }
    .btn-sm {
      padding: 6px 12px;
      font-size: 13px;
      font-weight: 500;
      border-radius: var(--radius-sm);
      border: none;
      background: var(--danger-muted);
      color: var(--danger);
      cursor: pointer;
      font-family: inherit;
      transition: background 0.15s, color 0.15s;
    }
    .btn-sm:hover {
      background: var(--danger);
      color: #fff;
    }
    .top-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 24px;
      flex-wrap: wrap;
      gap: 16px;
    }
    .top-bar .page-title { margin-bottom: 0; }
    .btn-primary {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 12px 22px;
      background: linear-gradient(135deg, var(--accent) 0%, #0088aa 100%);
      color: #000;
      border: 1px solid rgba(0,245,255,0.6);
      border-radius: var(--radius);
      font-size: 14px;
      font-weight: 700;
      font-family: var(--font-display);
      letter-spacing: 0.06em;
      cursor: pointer;
      box-shadow: 0 0 20px rgba(0,245,255,0.35), inset 0 1px 0 rgba(255,255,255,0.25);
      text-decoration: none;
      transition: box-shadow 0.2s ease, transform 0.15s ease;
    }
    .btn-primary:hover {
      box-shadow: 0 0 32px rgba(0,245,255,0.5), inset 0 1px 0 rgba(255,255,255,0.35);
      transform: translateY(-1px);
    }
    .empty-state {
      text-align: center;
      padding: 48px 24px;
      color: var(--text-muted);
      font-size: 15px;
      line-height: 1.6;
    }
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.85);
      backdrop-filter: blur(12px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 100;
      padding: 24px;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.25s ease, visibility 0.25s ease;
    }
    .modal-overlay.open {
      opacity: 1;
      visibility: visible;
    }
    .modal-overlay.open .modal {
      transform: scale(1);
      opacity: 1;
    }
    .modal {
      background: linear-gradient(180deg, var(--surface) 0%, var(--surface-soft) 100%);
      border: 1px solid var(--border-strong);
      border-radius: var(--radius-lg);
      width: 100%;
      max-width: 460px;
      max-height: 90vh;
      overflow: auto;
      box-shadow: 0 0 48px rgba(0,245,255,0.12), 0 24px 48px rgba(0,0,0,0.5), inset 0 1px 0 rgba(0,245,255,0.1);
      transform: scale(0.95);
      opacity: 0;
      transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.25s ease;
    }
    .modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 20px 24px;
      border-bottom: 1px solid var(--border);
    }
    .modal-header h2 {
      font-size: 18px;
      font-weight: 700;
      letter-spacing: -0.02em;
      margin: 0;
    }
    .modal-close {
      width: 36px;
      height: 36px;
      border: none;
      background: transparent;
      color: var(--text-muted);
      cursor: pointer;
      border-radius: var(--radius-sm);
      font-size: 22px;
      line-height: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: color 0.15s, background 0.15s;
    }
    .modal-close:hover {
      background: var(--surface-hover);
      color: var(--text);
    }
    .modal-body { padding: 24px; }
    .modal-body > p {
      font-size: 14px;
      color: var(--text-muted);
      margin: 0 0 20px 0;
      line-height: 1.55;
    }
    .modal-body code {
      background: var(--accent-muted);
      color: var(--accent);
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 13px;
    }
    .modal-divider {
      display: flex;
      align-items: center;
      gap: 16px;
      margin: 20px 0;
      font-size: 12px;
      font-weight: 500;
      color: var(--text-muted);
    }
    .modal-divider::before, .modal-divider::after {
      content: '';
      flex: 1;
      height: 1px;
      background: var(--border);
    }
    .form-group { margin-bottom: 18px; }
    .form-group label {
      display: block;
      font-size: 13px;
      font-weight: 500;
      color: var(--text-muted);
      margin-bottom: 6px;
    }
    .form-group input[type="text"],
    .form-group textarea {
      width: 100%;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      color: var(--text);
      padding: 12px 16px;
      font-size: 14px;
      font-family: inherit;
      transition: border-color 0.15s, box-shadow 0.15s;
    }
    .form-group input:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 2px var(--accent-muted), 0 0 20px rgba(0,245,255,0.1);
    }
    .form-group textarea { min-height: 120px; resize: vertical; }
    .form-group input::placeholder,
    .form-group textarea::placeholder { color: var(--text-muted); opacity: 0.8; }
    .form-group input[type="file"] {
      font-size: 13px;
      color: var(--text-muted);
      padding: 8px 0;
    }
    .modal-tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 18px;
    }
    .modal-tabs button {
      flex: 1;
      padding: 10px 14px;
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      background: transparent;
      color: var(--text-muted);
      font-size: 13px;
      font-weight: 500;
      font-family: inherit;
      cursor: pointer;
      transition: all 0.15s;
    }
    .modal-tabs button:hover {
      border-color: var(--border-strong);
      color: var(--text);
    }
    .modal-tabs button.active {
      border-color: var(--accent);
      background: var(--accent-muted);
      color: var(--accent);
      box-shadow: 0 0 16px rgba(0,245,255,0.12);
    }
    .modal-panel { display: none; }
    .modal-panel.active { display: block; }
    .modal-footer { padding: 0 24px 24px; }
    .modal-footer .btn-primary { width: 100%; justify-content: center; }
    /* 添加账号弹窗：与列表「名称 / 来源 / Account ID」对应，按钮与输入框美化 */
    .modal-add-account .modal { max-width: 520px; }
    .modal-add-account .modal-header {
      border-bottom-color: var(--border-strong);
      padding: 20px 28px;
    }
    .modal-add-account .modal-header h2 {
      font-family: var(--font-display);
      letter-spacing: 0.04em;
      color: var(--accent);
      text-shadow: 0 0 24px var(--accent-muted);
    }
    .modal-add-account .modal-close {
      width: 40px; height: 40px;
      border-radius: var(--radius);
      color: var(--text-muted);
      font-size: 24px;
    }
    .modal-add-account .modal-close:hover {
      background: var(--danger-muted);
      color: var(--danger);
    }
    .modal-add-account .modal-body { padding: 24px 28px 20px; }
    .modal-add-account .modal-body > p {
      font-size: 14px;
      color: var(--text-muted);
      margin-bottom: 20px;
      line-height: 1.6;
    }
    .modal-add-account .modal-desc {
      padding: 16px 20px;
      background: linear-gradient(135deg, var(--accent-soft) 0%, rgba(0,245,255,0.04) 100%);
      border: 1px solid var(--border);
      border-left: 4px solid var(--accent);
      border-radius: var(--radius);
      margin-bottom: 22px;
      font-size: 14px;
      color: var(--text);
      line-height: 1.65;
    }
    .modal-add-account .modal-desc code {
      background: var(--accent-muted);
      color: var(--accent);
      padding: 3px 8px;
      border-radius: 4px;
      font-size: 13px;
    }
    .modal-add-account .modal-tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }
    .modal-add-account .modal-tabs .modal-tab {
      flex: 1;
      padding: 12px 18px;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      background: var(--bg-elevated);
      color: var(--text-muted);
      font-size: 14px;
      font-weight: 600;
      font-family: inherit;
      cursor: pointer;
      transition: border-color 0.2s, color 0.2s, background 0.2s, box-shadow 0.2s;
    }
    .modal-add-account .modal-tabs .modal-tab:hover {
      border-color: var(--border-strong);
      color: var(--text);
    }
    .modal-add-account .modal-tabs .modal-tab.active {
      border-color: var(--accent);
      background: var(--accent-muted);
      color: var(--accent);
      box-shadow: 0 0 20px rgba(0,245,255,0.2);
    }
    .modal-add-account .form-group {
      margin-bottom: 20px;
    }
    .modal-add-account .form-group label {
      display: block;
      font-size: 13px;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 8px;
      letter-spacing: 0.02em;
    }
    .modal-add-account .form-group input[type="text"],
    .modal-add-account .form-group textarea {
      width: 100%;
      box-sizing: border-box;
      padding: 14px 18px;
      font-size: 14px;
      line-height: 1.5;
      color: var(--text);
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      font-family: inherit;
      transition: border-color 0.2s, box-shadow 0.2s;
    }
    .modal-add-account .form-group textarea {
      min-height: 140px;
      resize: vertical;
      font-family: ui-monospace, 'Cascadia Code', 'Consolas', monospace;
      font-size: 13px;
    }
    .modal-add-account .form-group input:focus,
    .modal-add-account .form-group textarea:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 2px var(--accent-muted), 0 0 24px rgba(0,245,255,0.15);
    }
    .modal-add-account .form-group input::placeholder,
    .modal-add-account .form-group textarea::placeholder {
      color: var(--text-muted);
      opacity: 0.85;
    }
    .modal-add-account .file-input-wrap {
      display: flex;
      gap: 12px;
      align-items: stretch;
    }
    .modal-add-account .file-input-wrap input[type="file"] {
      position: absolute;
      width: 0.1px;
      height: 0.1px;
      opacity: 0;
      overflow: hidden;
      z-index: -1;
    }
    .modal-add-account .file-input-wrap .file-input-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 0 24px;
      min-width: 120px;
      height: 48px;
      font-size: 14px;
      font-weight: 600;
      font-family: inherit;
      color: #000;
      background: linear-gradient(135deg, var(--accent) 0%, #00c4cc 100%);
      border: none;
      border-radius: var(--radius);
      cursor: pointer;
      box-shadow: 0 0 20px rgba(0,245,255,0.3);
      transition: box-shadow 0.2s, transform 0.15s;
    }
    .modal-add-account .file-input-wrap .file-input-btn:hover {
      box-shadow: 0 0 28px rgba(0,245,255,0.5);
      transform: translateY(-1px);
    }
    .modal-add-account .file-input-wrap .file-input-name {
      flex: 1;
      display: flex;
      align-items: center;
      padding: 0 18px;
      min-height: 48px;
      font-size: 14px;
      color: var(--text-muted);
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: var(--radius);
    }
    .modal-add-account .file-input-wrap .file-input-name.has-file {
      color: var(--accent);
      border-color: var(--accent-muted);
    }
    .modal-add-account .form-group input[type="file"] {
      padding: 12px 0;
      font-size: 14px;
      color: var(--text-muted);
      background: var(--bg);
      border: 1px dashed var(--border);
      border-radius: var(--radius);
      cursor: pointer;
    }
    .modal-add-account .form-group input[type="file"]:hover {
      border-color: var(--accent);
      color: var(--accent);
    }
    .modal-add-account .modal-table-hint {
      font-size: 13px;
      color: var(--text);
      margin: 20px 0 0;
      padding: 16px 20px;
      background: linear-gradient(90deg, var(--accent-muted) 0%, var(--bg-elevated) 100%);
      border-radius: var(--radius);
      border-left: 4px solid var(--accent);
      line-height: 1.65;
      box-shadow: 0 0 20px rgba(0,245,255,0.08);
    }
    .modal-add-account .modal-table-hint strong { color: var(--accent); }
    .modal-add-account .modal-footer {
      padding: 20px 28px 28px;
    }
    .modal-add-account .modal-footer .btn-primary {
      width: 100%;
      padding: 14px 24px;
      font-size: 15px;
      font-weight: 600;
      border-radius: var(--radius);
      background: linear-gradient(135deg, var(--accent) 0%, #00c4cc 100%);
      border: none;
      color: #000;
      box-shadow: 0 0 24px rgba(0,245,255,0.35);
      transition: transform 0.15s, box-shadow 0.2s;
    }
    .modal-add-account .modal-footer .btn-primary:hover {
      box-shadow: 0 0 32px rgba(0,245,255,0.5);
      transform: translateY(-1px);
    }
    .cli-hint {
      margin-top: 20px;
      padding: 18px 20px;
      background: var(--bg-elevated);
      border: 1px solid var(--border);
      border-left: 4px solid var(--accent);
      border-radius: var(--radius);
      font-size: 14px;
      color: var(--text);
      line-height: 1.65;
      box-shadow: 0 0 16px rgba(0,0,0,0.15);
    }
    .modal-add-account .cli-hint {
      margin-top: 16px;
      padding: 16px 20px;
      font-size: 13px;
      background: linear-gradient(90deg, rgba(0,245,255,0.06) 0%, var(--bg-elevated) 100%);
    }
    .cli-hint code,
    .modal-add-account .cli-hint code {
      color: var(--accent);
      background: var(--accent-muted);
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-family: ui-monospace, 'Cascadia Code', Consolas, monospace;
    }
    .msg {
      font-size: 14px;
      padding: 12px 14px;
      border-radius: var(--radius-sm);
      margin-top: 16px;
    }
    .msg.error {
      background: var(--danger-muted);
      color: #fda4af;
    }
    .msg.success {
      background: rgba(16,185,129,0.15);
      color: #6ee7b7;
    }
    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--success);
      display: inline-block;
      margin-right: 8px;
      vertical-align: middle;
      box-shadow: 0 0 0 2px rgba(16,185,129,0.3);
      animation: statusPulse 2s ease-in-out infinite;
    }
    .setting-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      padding: 16px 0;
      border-bottom: 1px solid var(--border);
    }
    .setting-row:last-child { border-bottom: none; padding-bottom: 0; }
    .setting-row .label { margin-bottom: 0; }
    .lang-select {
      min-width: 140px;
      padding: 8px 12px;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      color: var(--text);
      font-size: 14px;
      font-family: inherit;
      cursor: pointer;
    }
    .lang-select:focus {
      outline: none;
      border-color: var(--accent);
    }
    .btn-oauth {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 18px;
      background: transparent;
      color: var(--accent);
      border: 1px solid var(--accent);
      border-radius: var(--radius-sm);
      font-size: 14px;
      font-weight: 500;
      font-family: inherit;
      cursor: pointer;
      text-decoration: none;
      transition: all 0.15s;
    }
    .btn-oauth:hover {
      background: var(--accent-muted);
      box-shadow: 0 0 20px rgba(0,245,255,0.25);
    }
    .oauth-banner {
      padding: 12px 16px;
      border-radius: var(--radius-sm);
      margin-bottom: 20px;
      font-size: 14px;
      animation: bannerIn 0.35s ease-out;
    }
    @keyframes bannerIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .oauth-banner.success { background: var(--success-muted); color: var(--success); border: 1px solid rgba(0,255,136,0.3); box-shadow: 0 0 20px rgba(0,255,136,0.15); }
    .oauth-banner.error { background: var(--danger-muted); color: #ff6b8a; border: 1px solid rgba(255,51,102,0.3); box-shadow: 0 0 20px rgba(255,51,102,0.1); white-space: pre-line; }
    .btn-copy { margin-right: 8px; }
    .oauth-success-card {
      background: var(--bg-elevated);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 24px;
      margin-bottom: 20px;
      text-align: center;
    }
    .oauth-success-title { font-family: var(--font-display); font-size: 18px; font-weight: 700; color: var(--success); margin: 0 0 8px 0; text-shadow: 0 0 20px var(--success-muted); }
    .oauth-success-hint { font-size: 14px; color: var(--text-muted); margin: 0 0 20px 0; }
    .oauth-success-actions { display: flex; flex-wrap: wrap; gap: 12px; justify-content: center; }
    .btn-secondary {
      display: inline-flex; align-items: center; gap: 8px; padding: 12px 22px;
      background: transparent; color: var(--text-muted); border: 1px solid var(--border);
      border-radius: var(--radius); font-size: 14px; font-weight: 600;
      text-decoration: none; cursor: pointer; transition: all 0.2s ease;
    }
    .btn-secondary:hover { border-color: var(--accent); color: var(--accent); background: var(--accent-soft); box-shadow: 0 0 16px rgba(0,245,255,0.1); }
    #btnAddAccount {
      padding: 10px 20px;
      font-weight: 600;
      border-radius: var(--radius);
      border-color: var(--border-strong);
    }
    #btnAddAccount:hover {
      border-color: var(--accent);
      color: var(--accent);
      box-shadow: 0 0 20px rgba(0,245,255,0.15);
    }
    .invoke-nav { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 20px; }
    .invoke-nav-btn {
      padding: 10px 16px; border: 1px solid var(--border); border-radius: var(--radius-sm);
      background: var(--bg-elevated); color: var(--text-muted); font-size: 13px; font-weight: 500;
      cursor: pointer; transition: all 0.15s; font-family: inherit;
    }
    .invoke-nav-btn:hover { border-color: var(--border-strong); color: var(--text); }
    .invoke-nav-btn.active { border-color: var(--accent); background: var(--accent-muted); color: var(--accent); box-shadow: 0 0 16px rgba(0,245,255,0.15); }
    .invoke-panel { display: none; }
    .invoke-panel.active { display: block; }
    .doc-content { max-width: 720px; }
    .doc-section { margin-bottom: 28px; }
    .doc-h2 { font-family: var(--font-display); font-size: 16px; font-weight: 700; letter-spacing: 0.05em; color: var(--text); margin: 0 0 8px 0; }
    .doc-p { font-size: 14px; color: var(--text-muted); margin: 0 0 12px 0; line-height: 1.5; }
    .doc-pre {
      background: var(--bg-elevated);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      padding: 14px 16px;
      font-size: 13px;
      color: var(--text);
      overflow-x: hidden;
      white-space: pre-wrap;
      word-break: break-word;
      overflow-wrap: break-word;
    }
    .doc-pre code { background: transparent; padding: 0; white-space: pre-wrap; word-break: break-word; overflow-wrap: break-word; }
    .doc-pre .doc-method { color: var(--accent); font-weight: 600; }
    .doc-pre .doc-url,
    .doc-content .doc-url,
    .doc-content code.doc-url { color: var(--accent); }
    .doc-pre[class*="language-"] { margin: 0; border-radius: var(--radius-sm); background: var(--bg-elevated) !important; border: 1px solid var(--border); overflow-x: hidden; white-space: pre-wrap !important; word-break: break-word; overflow-wrap: break-word; }
    .doc-pre code[class*="language-"] { font-size: 13px; background: transparent !important; white-space: pre-wrap !important; word-break: break-word; overflow-wrap: break-word; }
    #invokeDocContent pre[class*="language-"], #invokeDocContent pre[class*="language-"] code { overflow-x: hidden !important; }
    .models-account-row {
      display: grid;
      grid-template-columns: 1fr 180px 44px;
      gap: 12px;
      align-items: center;
      font-size: 13px;
      margin-bottom: 8px;
    }
    .models-account-row:last-child { margin-bottom: 0; }
    .models-account-info { display: flex; flex-direction: column; gap: 2px; min-width: 0; }
    .models-account-name { color: var(--text); }
    .models-account-used { font-size: 11px; color: var(--text-muted); font-variant-numeric: tabular-nums; }
    .models-account-quota { color: var(--text-muted); white-space: nowrap; text-align: right; font-variant-numeric: tabular-nums; }
    .quota-bar-wrap { min-width: 0; }
    .quota-bar { width: 100%; height: 8px; background: var(--border); border-radius: 4px; overflow: hidden; }
    .quota-bar .quota-fill { height: 100%; border-radius: 4px; background: var(--success); transition: width 0.2s ease; box-shadow: 0 0 12px var(--success-muted); }
    .quota-bar .quota-fill.low { background: var(--neon-yellow); box-shadow: 0 0 12px rgba(255,184,0,0.4); }
    .quota-bar .quota-fill.empty { background: var(--danger); box-shadow: 0 0 12px var(--danger-muted); }
    #modelsTable td:first-child { color: var(--text-muted); }
    #modelsTable td:last-child { min-width: 280px; }
    .doc-cmd-label { font-size: 12px; font-weight: 600; color: var(--text-muted); margin-bottom: 6px; }
    .doc-cmd-block { margin-bottom: 16px; }
    .doc-cmd-block:last-child { margin-bottom: 0; }
    .quota-total-card { margin-bottom: 20px; }
    .quota-total-bar-wrap { display: flex; align-items: center; gap: 12px; margin-top: 4px; }
    .chart-wrap {
      position: relative;
      width: 100%;
      height: 320px;
      margin: 20px 0 8px;
      padding: 0;
    }
    .chart-wrap canvas { display: block; width: 100% !important; height: 100% !important; }
    .chart-hint {
      font-size: 13px;
      color: var(--text-muted);
      margin-top: 16px;
      line-height: 1.55;
      padding-left: 2px;
    }
    #dashQuotaChart { display: block; }
    .section-card { width: 100%; box-sizing: border-box; }

    .topbar-menu-btn {
      display: none;
      width: 40px; height: 40px;
      border: none; background: transparent; color: var(--text);
      border-radius: var(--radius-sm); cursor: pointer;
      align-items: center; justify-content: center;
      margin-right: 8px;
    }
    .topbar-menu-btn svg { width: 22px; height: 22px; }
    .sidebar-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      z-index: 9;
      opacity: 0;
      transition: opacity 0.2s;
    }
    body.sidebar-open .sidebar-overlay { opacity: 1; }

    @media (max-width: 1024px) {
      .sidebar {
        width: 260px;
        z-index: 10;
        transform: translateX(-100%);
        transition: transform 0.25s ease;
        box-shadow: 4px 0 24px rgba(0,0,0,0.3);
      }
      body.sidebar-open .sidebar { transform: translateX(0); }
      .sidebar-overlay { display: block; pointer-events: none; }
      body.sidebar-open .sidebar-overlay { pointer-events: auto; }
      .right-col { margin-left: 0; }
      .topbar-menu-btn { display: flex; }
      .main { padding: 20px 20px 32px; }
      .page-header { flex-wrap: wrap; gap: 12px; }
      .section-card { padding: 18px; }
      .table-wrap { overflow-x: auto; -webkit-overflow-scrolling: touch; }
      .logs-table { min-width: 600px; }
      .topbar-sub { display: none; }
    }
    @media (max-width: 768px) {
      .main { padding: 16px 16px 24px; }
      .page-title { font-size: 20px; }
      .page-header { margin-bottom: 20px; }
      .section-card { padding: 16px; margin-bottom: 16px; }
      .dash-cards { grid-template-columns: 1fr; }
      .search-wrap { min-width: 0; width: 100%; max-width: 100%; }
      .search-input { max-width: 100%; }
      .topbar { padding: 0 16px; height: 52px; flex-wrap: wrap; }
      .topbar-status .btn-icon-text { padding: 0 8px; font-size: 11px; }
      .invoke-nav { flex-direction: column; }
      .invoke-nav .invoke-nav-btn { width: 100%; }
      .doc-pre, .doc-pre code { font-size: 12px; }
      .settings-tabs { flex-wrap: wrap; }
      .oauth-success-actions { flex-direction: column; }
    }
    @media (max-width: 480px) {
      .main { padding: 12px 12px 20px; }
      .page-title { font-size: 18px; }
      .section-card { padding: 14px; }
      .table-wrap th, .table-wrap td { padding: 10px 12px; font-size: 12px; }
      .btn-primary, .btn-secondary { width: 100%; justify-content: center; }
      .topbar-title { font-size: 14px; }
      .logo-text { font-size: 15px; }
      .menu a { padding: 10px 16px; font-size: 13px; }
    }

    /* ========== 开屏动画：从两边聚合，播完后滑出，不可回退 ========== */
    .intro {
      position: fixed;
      inset: 0;
      z-index: 9999;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: var(--bg);
      overflow: hidden;
      transition: transform 2.2s cubic-bezier(0.33, 1, 0.68, 1), opacity 1.75s cubic-bezier(0.33, 1, 0.68, 1);
    }
    .intro.done {
      transform: translateY(-100%);
      opacity: 0;
      pointer-events: none;
    }
    .intro-bg {
      position: absolute;
      inset: 0;
      background:
        radial-gradient(ellipse 120% 80% at 50% 50%, rgba(0,245,255,0.12) 0%, transparent 55%),
        repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,245,255,0.03) 2px, rgba(0,245,255,0.03) 4px);
    }
    .intro-lines {
      position: absolute;
      left: 0;
      right: 0;
      top: 50%;
      height: 2px;
      margin-top: -1px;
      pointer-events: none;
    }
    .intro-line-left,
    .intro-line-right {
      position: absolute;
      top: 0;
      width: 50%;
      height: 100%;
      background: linear-gradient(90deg, transparent, var(--accent));
      box-shadow: 0 0 24px var(--accent);
      animation: introLineIn 1.8s cubic-bezier(0.22, 1, 0.36, 1) 0.4s forwards;
    }
    .intro-line-left {
      left: 0;
      transform-origin: left center;
      transform: scaleX(0);
    }
    .intro-line-right {
      right: 0;
      transform-origin: right center;
      transform: scaleX(0);
      background: linear-gradient(90deg, var(--accent), transparent);
    }
    @keyframes introLineIn {
      to { transform: scaleX(1); }
    }
    .intro-content {
      position: relative;
      z-index: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      padding: 24px;
    }
    .intro-title-wrap {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 0.12em;
      margin: 0;
    }
    .intro-title-left,
    .intro-title-right {
      display: inline-block;
      font-family: var(--font-display);
      font-size: clamp(2.6rem, 11vw, 5rem);
      font-weight: 800;
      letter-spacing: 0.15em;
      color: var(--text);
      text-shadow: 0 0 60px rgba(0,245,255,0.5), 0 0 120px rgba(0,245,255,0.2);
      opacity: 0;
    }
    .intro-title-left {
      transform: translateX(-120%);
      animation: introMeetCenter 1.4s cubic-bezier(0.22, 1, 0.36, 1) 1s forwards;
    }
    .intro-title-right {
      transform: translateX(120%);
      animation: introMeetCenter 1.4s cubic-bezier(0.22, 1, 0.36, 1) 1.15s forwards;
    }
    @keyframes introMeetCenter {
      to { opacity: 1; transform: translateX(0); }
    }
    .intro-sub {
      font-family: var(--font-display);
      font-size: clamp(0.85rem, 2.5vw, 1.1rem);
      font-weight: 700;
      letter-spacing: 0.4em;
      color: var(--accent);
      margin-top: 20px;
      opacity: 0;
      animation: introFadeIn 0.8s ease-out 2.6s forwards;
      text-shadow: 0 0 30px rgba(0,245,255,0.4);
    }
    .intro-tagline {
      font-size: clamp(0.8rem, 2vw, 1rem);
      color: var(--text-muted);
      margin-top: 24px;
      max-width: 340px;
      line-height: 1.6;
      opacity: 0;
      animation: introFadeIn 0.8s ease-out 3.2s forwards;
    }
    @keyframes introFadeIn {
      to { opacity: 1; }
    }
    .intro-progress {
      position: absolute;
      bottom: 48px;
      left: 50%;
      transform: translateX(-50%);
      width: 140px;
      height: 3px;
      background: var(--border);
      border-radius: 2px;
      overflow: hidden;
    }
    .intro-progress-bar {
      height: 100%;
      width: 0;
      background: linear-gradient(90deg, var(--accent), var(--accent-hover));
      box-shadow: 0 0 16px var(--accent);
      animation: introProgress 1.4s ease-in 2.6s forwards;
    }
    @keyframes introProgress {
      to { width: 100%; }
    }
    body:not(.intro-done) .sidebar,
    body:not(.intro-done) .right-col {
      opacity: 0;
      transition: opacity 0.4s ease 0.2s;
    }
    body.intro-done .sidebar,
    body.intro-done .right-col {
      opacity: 1;
    }
  </style>
</head>
<body>
  <div class="intro" id="intro" aria-label="Loading">
    <div class="intro-bg"></div>
    <div class="intro-lines" aria-hidden="true">
      <div class="intro-line-left"></div>
      <div class="intro-line-right"></div>
    </div>
    <div class="intro-content">
      <h1 class="intro-title-wrap" aria-hidden="true">
        <span class="intro-title-left">CODEX</span>
        <span class="intro-title-right">PRO API</span>
      </h1>
      <p class="intro-sub">PROXY SYSTEM</p>
      <p class="intro-tagline" data-i18n="intro.tagline">Round-robin · Multi-account · One-click</p>
    </div>
    <div class="intro-progress"><div class="intro-progress-bar"></div></div>
  </div>
  <div class="sidebar-overlay" id="sidebarOverlay" aria-hidden="true"></div>
  <aside class="sidebar" id="sidebar">
    <div class="logo">
      <div class="logo-icon">CP</div>
      <div>
        <div class="logo-text">Codex Pro API</div>
        <div class="logo-sub" data-i18n="version.proxy">Proxy v…</div>
      </div>
    </div>
    <nav class="menu">
      <div class="menu-label" data-i18n="menu.main">Main</div>
      <a href="#/dashboard" class="nav-link" data-view="dashboard" data-i18n="nav.dashboard">Dashboard</a>
      <a href="#/models" class="nav-link" data-view="models" data-i18n="nav.models">Models</a>
      <a href="#/accounts" class="nav-link" data-view="accounts" data-i18n="nav.accounts">Accounts</a>
      <a href="#/invoke" class="nav-link" data-view="invoke" data-i18n="nav.invoke">调用</a>
      <div class="menu-label" data-i18n="menu.system">System</div>
      <a href="#/logs" class="nav-link" data-view="logs" data-i18n="nav.logs">Logs</a>
      <a href="#/settings" class="nav-link" data-view="settings" data-i18n="nav.settings">Settings</a>
    </nav>
    <div class="sidebar-footer">
      <a href="https://free.violetteam.cloud/" target="_blank" rel="noopener" class="footer-recommend" data-i18n-html="footer.violetteam">推荐使用 free.violetteam.cloud<br>注册 ChatGPT 小号并添加</a>
      <a href="https://github.com/violettoolssite/codexProapi" target="_blank" rel="noopener" class="footer-github" aria-label="GitHub" title="GitHub"><svg viewBox="0 0 16 16" aria-hidden="true"><path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/></svg></a>
    </div>
  </aside>

  <div class="right-col">
    <header class="topbar">
      <div style="display: flex; align-items: center;">
        <button type="button" class="topbar-menu-btn" id="btnSidebarToggle" aria-label="Menu">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18M3 12h18M3 18h18"/></svg>
        </button>
        <div>
          <div class="topbar-title">Codex Pro API</div>
          <div class="topbar-sub" data-i18n="topbar.subtitle">CODEX PROXY SYSTEM v…</div>
        </div>
      </div>
      <div class="topbar-status">
        <span class="dot"></span>
        <span class="label" data-i18n="topbar.online">ONLINE</span>
        <button type="button" class="btn-icon btn-icon-text" id="btnRefresh" title="Refresh" aria-label="Refresh">Refresh</button>
      </div>
    </header>

  <main class="main">
    <div id="view-dashboard" class="view active">
      <div class="page-header">
        <div>
          <h1 class="page-title" data-i18n="page.dashboard">Dashboard</h1>
          <div class="page-subtitle" data-i18n="dash.tag">CODEX PROXY SYSTEM</div>
        </div>
        <div class="page-live">
          <span class="dot"></span>
          <span data-i18n="dash.live">LIVE</span>
          <span id="dashTime">--:--:--</span>
        </div>
      </div>
      <div class="cards">
        <div class="card">
          <div class="label" data-i18n="dash.accounts">Accounts</div>
          <div class="value" id="dash-account-count">0</div>
          <div class="hint" data-i18n="dash.accounts_hint">Round-robin enabled</div>
        </div>
        <div class="card">
          <div class="label" data-i18n="dash.status">API Status</div>
          <div class="value"><span class="status-dot"></span><span data-i18n="dash.status_running">Running</span></div>
          <div class="hint" id="dash-endpoint">—</div>
        </div>
      </div>
      <div class="section-card">
        <h3 data-i18n="dash.quota_chart">各模型已用 Token 趋势</h3>
        <div class="chart-wrap">
          <canvas id="dashQuotaChart"></canvas>
        </div>
        <div class="chart-hint" data-i18n="dash.chart_hint">按 token 计算，所有账号已用 token 合计随时间上升</div>
      </div>
    </div>

    <div id="view-models" class="view">
      <div class="page-header">
        <div>
          <h1 class="page-title" data-i18n="page.models">Models</h1>
          <div class="page-subtitle" data-i18n="models.subtitle">Real-time quota and status for available models</div>
        </div>
        <div class="search-wrap">
          <input type="text" class="search-input" id="modelsSearch" data-i18n-placeholder="models.search" placeholder="Search models...">
        </div>
      </div>
      <div id="modelsQuotaTotal" class="card quota-total-card">
        <div class="label" data-i18n="invoke.total_quota">总剩余</div>
        <div class="quota-total-bar-wrap">
          <div class="quota-bar" style="max-width: 200px;"><div class="quota-fill" id="modelsTotalQuotaBar" style="width: 0;"></div></div>
          <span class="value" id="modelsTotalQuotaValue">—</span>
        </div>
        <div class="hint" data-i18n="models.total_hint">各账号单独计算，未使用显示 100%</div>
      </div>
      <div class="table-wrap">
        <table id="modelsTable">
          <thead>
            <tr>
              <th data-i18n="models.id">Model ID</th>
              <th data-i18n="models.accounts_quota">各账号剩余额度</th>
            </tr>
          </thead>
          <tbody id="modelsTableBody"></tbody>
        </table>
      </div>
    </div>

    <div id="view-accounts" class="view">
      <div id="oauthBanner" class="oauth-banner" style="display: none;"></div>
      <div id="oauthSuccessCard" class="oauth-success-card" style="display: none;">
        <p class="oauth-success-title" id="oauthSuccessTitle">登录成功！</p>
        <p class="oauth-success-hint" id="oauthSuccessHint">可关闭此标签页或返回主页面刷新账号列表。</p>
        <div class="oauth-success-actions">
          <button type="button" class="btn-primary" id="oauthBtnCloseTab" data-i18n="msg.oauth_close_btn">关闭此标签页</button>
          <a href="#" class="btn-secondary" id="oauthBtnReturn" data-i18n="msg.oauth_return_btn">返回主页面</a>
        </div>
      </div>
      <div class="page-header">
        <div>
          <h1 class="page-title" data-i18n="page.accounts">Accounts</h1>
          <div class="page-subtitle" data-i18n="accounts.subtitle">Manage Codex account tokens and authorization</div>
        </div>
        <div style="display: flex; align-items: center; gap: 12px; flex-wrap: wrap;">
          <div class="search-wrap">
            <input type="text" class="search-input" id="accountsSearch" data-i18n-placeholder="accounts.search" placeholder="Search accounts...">
          </div>
          <button type="button" class="btn-icon btn-icon-text" id="btnReloadAccounts" title="Reload" aria-label="Reload">Reload</button>
          <span id="accountsCount" style="font-size: 13px; color: var(--text-muted);">0</span>
          <button type="button" class="btn-secondary" id="btnAddAccount" data-i18n="accounts.add">Add New Account</button>
          <a href="/auth/login" class="btn-primary" id="oauthLoginBtn" data-i18n="accounts.oauth_login">Login with Codex</a>
        </div>
      </div>
      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th data-i18n="accounts.name">Name</th>
              <th data-i18n="accounts.source">Source</th>
              <th data-i18n="accounts.account_id">Account ID</th>
              <th></th>
            </tr>
          </thead>
          <tbody id="accountList"></tbody>
        </table>
      </div>
      <p id="emptyTip" class="empty-state" style="display: none;" data-i18n="accounts.empty">No accounts yet. Use Login with Codex to add an account.</p>
    </div>

    <div id="view-invoke" class="view">
      <div class="page-header">
        <div>
          <h1 class="page-title" data-i18n="page.invoke">调用文档</h1>
          <div class="page-subtitle" data-i18n="invoke.subtitle">API 调用说明与示例</div>
        </div>
      </div>
      <nav class="invoke-nav" id="invokeNav">
        <button type="button" class="invoke-nav-btn active" data-invoke="base" data-i18n="invoke.base_url">基础地址</button>
        <button type="button" class="invoke-nav-btn" data-invoke="health">GET /health</button>
        <button type="button" class="invoke-nav-btn" data-invoke="models">GET /v1/models</button>
        <button type="button" class="invoke-nav-btn" data-invoke="chat">POST /v1/chat/completions</button>
      </nav>
      <div class="doc-content" id="invokeDocContent">
        <section id="invoke-panel-base" class="invoke-panel active">
          <h2 class="doc-h2" data-i18n="invoke.base_url">Base URL</h2>
          <p class="doc-p"><code id="docBaseUrl" class="doc-url">—</code></p>
          <p class="doc-p hint" style="margin-top: 8px;" data-i18n="invoke.base_url_hint">在 CLINE、Cursor 等客户端中请填写上述地址（须含 /v1）。</p>
        </section>
        <section id="invoke-panel-health" class="invoke-panel">
          <h2 class="doc-h2">GET /health</h2>
          <p class="doc-p" data-i18n="invoke.health_desc">健康检查，返回服务状态。</p>
          <div id="docHealthCmds"></div>
        </section>
        <section id="invoke-panel-models" class="invoke-panel">
          <h2 class="doc-h2">GET /v1/models</h2>
          <p class="doc-p" data-i18n="invoke.models_desc">返回可用模型列表（OpenAI 格式）。</p>
          <div id="docModelsCmds"></div>
        </section>
        <section id="invoke-panel-chat" class="invoke-panel">
          <h2 class="doc-h2">POST /v1/chat/completions</h2>
          <p class="doc-p" data-i18n="invoke.chat_desc">对话补全，与 OpenAI Chat Completions 兼容，支持 stream。</p>
          <div id="docChatCmds"></div>
        </section>
      </div>
    </div>

    <div id="view-logs" class="view">
      <div class="page-header">
        <div>
          <h1 class="page-title" data-i18n="page.logs">Logs</h1>
          <div class="page-subtitle">~/logs</div>
        </div>
        <div style="display: flex; align-items: center; gap: 12px; flex-wrap: wrap;">
          <div class="search-wrap">
            <input type="text" class="search-input" id="logsSearch" placeholder="grep logs..." data-i18n-placeholder="logs.grep">
          </div>
          <div class="logs-level-filters">
            <label><input type="checkbox" id="logFilterInfo" checked> <span class="log-badge info">INFO</span></label>
            <label><input type="checkbox" id="logFilterSuccess" checked> <span class="log-badge success">SUCCESS</span></label>
            <label><input type="checkbox" id="logFilterWarn" checked> <span class="log-badge warn">WARN</span></label>
            <label><input type="checkbox" id="logFilterErr" checked> <span class="log-badge err">ERR</span></label>
          </div>
          <span id="logsCount" style="font-size: 12px; color: var(--text-muted);">0/0</span>
          <button type="button" class="btn-icon btn-icon-text" id="btnRefreshLogs" data-i18n="logs.refresh">Refresh</button>
          <button type="button" class="btn-icon" id="btnClearLogs" data-i18n-title="logs.clear" title="Clear logs" aria-label="Clear logs">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></svg>
          </button>
        </div>
      </div>
      <div class="section-card">
        <div id="logsPlaceholder" class="logs-placeholder" data-i18n="logs.empty">No logs yet. API request logs will appear here when available.</div>
        <div id="logsList" class="log-entries" style="display: none;"></div>
      </div>
    </div>

    <div id="view-settings" class="view">
      <div class="page-header">
        <div>
          <h1 class="page-title" data-i18n="page.settings">Settings</h1>
          <div class="page-subtitle" data-i18n="settings.system_config">System Configuration</div>
        </div>
      </div>
      <div class="settings-tabs">
        <button type="button" class="settings-tab active" data-tab="interface" data-i18n="settings.tab_interface">Interface</button>
        <button type="button" class="settings-tab" data-tab="server" data-i18n="settings.tab_server">Server</button>
      </div>
      <div id="settings-interface" class="settings-panel active">
        <div class="settings-grid">
          <div class="card" style="max-width: 100%;">
            <h3 class="settings-section-title" data-i18n="settings.section_interface">界面</h3>
            <div class="setting-row">
              <div>
                <div class="label" data-i18n="settings.language">Language</div>
                <div class="hint" style="margin-top: 2px;" data-i18n="settings.language_hint">Switch interface language</div>
              </div>
              <select class="lang-select" id="langSelect" aria-label="Language">
                <option value="zh">中文</option>
                <option value="en">English</option>
              </select>
            </div>
          </div>
          <div class="card" style="max-width: 100%;">
            <h3 class="settings-section-title" data-i18n="settings.section_about">关于</h3>
            <div class="settings-about">
              <span class="ver" id="settings-version" data-i18n="version.short">v…</span>
              <span data-i18n="settings.about_desc">Codex Pro API · OpenAI 兼容代理</span>
              <div style="margin-top: 10px;">
                <a href="https://github.com/violettoolssite/codexProapi" target="_blank" rel="noopener" style="color: var(--accent); font-size: 12px;">GitHub</a>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div id="settings-server" class="settings-panel">
        <div class="settings-grid">
          <div class="card" style="max-width: 100%;">
            <h3 class="settings-section-title" data-i18n="settings.section_apikey">API Key</h3>
            <div class="label" data-i18n="settings.apikey_label">密钥（可选，仅一个）</div>
            <div class="hint" style="margin-bottom: 8px;" data-i18n="settings.apikey_hint">未设置时客户端可任意填写；设置后可在客户端中填写此密钥。</div>
            <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
              <input type="password" id="settingsApikeyInput" class="search-input" style="flex: 1; min-width: 200px; max-width: 360px;" placeholder="" data-i18n-placeholder="settings.apikey_placeholder" autocomplete="off">
              <button type="button" class="btn-copy" id="btnSaveApikey" data-i18n="settings.save">保存</button>
            </div>
          </div>
          <div class="card" style="max-width: 100%;">
            <h3 class="settings-section-title" data-i18n="settings.section_api">API 与端点</h3>
            <div class="label" data-i18n="settings.api_url">API Base URL</div>
            <div class="settings-url-block">
              <code id="settings-baseurl">—</code>
              <button type="button" class="btn-copy" id="btnCopyApiUrl" data-i18n="settings.copy">复制</button>
            </div>
            <div class="hint" style="padding-top: 0;" data-i18n="settings.api_hint">在客户端中请填写上述地址（须含 /v1）。</div>
            <div class="label" style="margin-top: 14px;" data-i18n="settings.model_label">推荐模型</div>
            <code class="settings-model-pill">gpt-5.3-codex</code>
          </div>
          <div class="card" style="max-width: 100%;">
            <h3 class="settings-section-title" data-i18n="settings.section_links">常用链接</h3>
            <ul class="settings-quick-links">
              <li><a href="/health" target="_blank" rel="noopener"><svg class="link-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 11-5.93-9.14"/><path d="M22 4L12 14.01l-3-3"/></svg><span data-i18n="settings.link_health">健康检查</span></a></li>
              <li><a href="#" id="settingsLinkOAuth"><svg class="link-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 3h4a2 2 0 012 2v14a2 2 0 01-2 2h-4"/><polyline points="10 17 15 12 10 7"/><line x1="15" y1="12" x2="3" y2="12"/></svg><span data-i18n="settings.link_oauth">使用 Codex 登录</span></a></li>
              <li><a href="#/invoke"><svg class="link-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg><span data-i18n="settings.link_invoke">调用文档</span></a></li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </main>
  </div>

  <div class="modal-overlay" id="addAccountModalOverlay" aria-hidden="true">
    <div class="modal modal-add-account" role="dialog" aria-labelledby="addAccountModalTitle">
      <div class="modal-header">
        <h2 id="addAccountModalTitle" data-i18n="modal.add_title">添加账号</h2>
        <button type="button" class="modal-close" id="addAccountModalClose" aria-label="Close">&times;</button>
      </div>
      <div class="modal-body">
        <p class="modal-desc" data-i18n="modal.desc">粘贴 Codex auth.json 内容或上传文件，该账号将参与轮询请求。</p>
        <div class="modal-tabs">
          <button type="button" class="modal-tab active" data-tab="paste" data-i18n="modal.paste_tab">粘贴 JSON</button>
          <button type="button" class="modal-tab" data-tab="upload" data-i18n="modal.upload_tab">上传文件</button>
        </div>
        <div id="addAccountPanelPaste" class="modal-panel active">
          <div class="form-group">
            <label data-i18n="modal.auth_content">auth.json 内容</label>
            <textarea id="addAccountAuthText" data-i18n-placeholder="modal.auth_placeholder" placeholder='{"tokens":{"access_token":"...","account_id":"..."}}' rows="6"></textarea>
          </div>
        </div>
        <div id="addAccountPanelUpload" class="modal-panel">
          <div class="form-group">
            <label data-i18n="modal.select_file">选择 auth.json 文件</label>
            <div class="file-input-wrap">
              <input type="file" id="addAccountFile" accept=".json,application/json">
              <button type="button" class="file-input-btn" id="addAccountFileBtn" data-i18n="modal.select_file_btn">选择文件</button>
              <span class="file-input-name" id="addAccountFileName" data-i18n="modal.no_file">未选择文件</span>
            </div>
          </div>
        </div>
        <div class="form-group">
          <label data-i18n="modal.name_label">名称（选填）</label>
          <input type="text" id="addAccountName" data-i18n-placeholder="modal.name_placeholder" placeholder="">
        </div>
        <p class="modal-table-hint" data-i18n-html="modal.table_hint_html">添加后在账号列表中显示：<strong>名称</strong>、<strong>来源</strong>、<strong>Account ID</strong>。</p>
        <p class="cli-hint" data-i18n="modal.cli_hint">从 ~/.codex/auth.json（Windows：%USERPROFILE%\.codex\auth.json）复制内容粘贴到上方。</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn-primary" id="addAccountSubmit" data-i18n="modal.add_btn">添加账号</button>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js" onerror="this.onerror=null;this.src='https://unpkg.com/chart.js@4.4.1/dist/chart.umd.min.js'"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/prism.min.js" onerror="this.onerror=null;this.src='https://unpkg.com/prismjs@1.29.0/prism.min.js'"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-bash.min.js" onerror="this.onerror=null;this.src='https://unpkg.com/prismjs@1.29.0/components/prism-bash.min.js'"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-python.min.js" onerror="this.onerror=null;this.src='https://unpkg.com/prismjs@1.29.0/components/prism-python.min.js'"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-javascript.min.js" onerror="this.onerror=null;this.src='https://unpkg.com/prismjs@1.29.0/components/prism-javascript.min.js'"></script>
  <script>
    (function intro() {
      var el = document.getElementById('intro');
      if (!el) return;
      setTimeout(function() {
        document.body.classList.add('intro-done');
        el.classList.add('done');
        setTimeout(function() { el.remove(); }, 2300);
      }, 4300);
    })();
    const API = '';
    const STORAGE_LOCALE = 'codex-proapi-locale';
    const MODEL_IDS = ['gpt-5.3-codex', 'gpt-5.2-codex', 'gpt-5-codex', 'gpt-5', 'gpt-4'];
    const DASH_MAX_POINTS = 10;
    let usageHistory = [];
    let dashChartInstance = null;
    let dashPollTimer = null;

    function pushUsageSnapshot(usageData) {
      const accounts = (usageData && usageData.accounts) ? usageData.accounts : [];
      let totalUsedTokens = 0;
      accounts.forEach(function(a) {
        var u = (a.used_tokens != null && typeof a.used_tokens === 'number') ? a.used_tokens : 0;
        totalUsedTokens += u;
      });
      const byModel = {};
      MODEL_IDS.forEach(function(id) { byModel[id] = totalUsedTokens; });
      usageHistory.push({ t: Date.now(), byModel: byModel });
      if (usageHistory.length > DASH_MAX_POINTS) usageHistory.shift();
    }

    function formatChartTime(ts) {
      var d = new Date(ts);
      return d.getHours() + ':' + String(d.getMinutes()).padStart(2, '0') + ':' + String(d.getSeconds()).padStart(2, '0');
    }

    function updateDashboardChart() {
      var canvas = document.getElementById('dashQuotaChart');
      if (!canvas || typeof Chart === 'undefined') return;
      var ctx = canvas.getContext('2d');
      var labels = usageHistory.map(function(p) { return formatChartTime(p.t); });
      var colors = ['#06b6d4', '#10b981', '#f59e0b', '#8b5cf6', '#ec4899'];
      var dashes = [[], [8, 4], [4, 4], [2, 2], [1, 3]];
      var datasets = MODEL_IDS.map(function(modelId, i) {
        return {
          label: modelId,
          data: usageHistory.map(function(p) { return p.byModel[modelId]; }),
          borderColor: colors[i % colors.length],
          backgroundColor: colors[i % colors.length] + '20',
          borderWidth: 2.5,
          borderDash: dashes[i % dashes.length],
          fill: false,
          tension: 0.2,
          pointRadius: usageHistory.length <= 3 ? 5 : 3,
          pointHoverRadius: 6,
        };
      });
      var maxDataVal = 0;
      datasets.forEach(function(ds) { ds.data.forEach(function(v) { if (v > maxDataVal) maxDataVal = v; }); });
      var yMax = maxDataVal < 100 ? 100 : (maxDataVal < 5000 ? Math.ceil(maxDataVal * 1.15 / 500) * 500 : Math.ceil(maxDataVal * 1.1 / 10000) * 10000);
      function formatTokenTick(v) {
        if (v >= 1000000) return (v / 1000000).toFixed(1) + 'M';
        if (v >= 1000) return (v / 1000) + 'k';
        return String(Math.round(v));
      }
      if (dashChartInstance) {
        dashChartInstance.data.labels = labels;
        dashChartInstance.data.datasets = datasets;
        dashChartInstance.options.scales.y.max = yMax;
        dashChartInstance.options.scales.y.ticks.callback = function(v) { return formatTokenTick(v); };
        dashChartInstance.update('none');
        return;
      }
      dashChartInstance = new Chart(ctx, {
        type: 'line',
        data: { labels: labels, datasets: datasets },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            x: {
              grid: { color: 'rgba(255,255,255,0.14)' },
              ticks: { color: '#e2e8f0', font: { size: 13 }, maxTicksLimit: 14 },
            },
            y: {
              min: 0,
              max: yMax,
              grid: { color: 'rgba(255,255,255,0.14)' },
              ticks: { color: '#e2e8f0', font: { size: 13 }, callback: function(v) { return formatTokenTick(v); } },
            },
          },
          plugins: {
            legend: {
              labels: { color: '#f1f5f9', font: { size: 13 }, padding: 16, usePointStyle: true },
            },
          },
        },
      });
    }

    const translations = {
      zh: {
        'menu.main': '主菜单',
        'menu.system': '系统',
        'nav.dashboard': '仪表盘',
        'nav.models': '模型',
        'nav.accounts': '账号',
        'nav.invoke': '调用',
        'nav.logs': '日志',
        'nav.settings': '设置',
        'topbar.subtitle': 'CODEX PROXY SYSTEM v{{version}}',
        'version.proxy': 'Proxy v{{version}}',
        'version.short': 'v{{version}}',
        'topbar.online': '在线',
        'page.dashboard': '仪表盘',
        'page.models': '模型',
        'page.accounts': '账号',
        'page.settings': '设置',
        'dash.tag': 'CODEX PROXY SYSTEM',
        'intro.tagline': '轮询 · 多账号 · 一键登录',
        'dash.live': '实时',
        'dash.accounts': '账号数',
        'dash.accounts_hint': '已启用轮询',
        'dash.status': 'API 状态',
        'dash.request_volume': '请求量',
        'dash.no_data': '暂无数据',
        'dash.quota_chart': '各模型已用 Token 趋势',
        'dash.chart_hint': '按 token 计算，所有账号已用 token 合计随时间上升',
        'page.logs': '日志',
        'logs.empty': '暂无日志。API 请求日志将在此显示。',
        'logs.refresh': '刷新',
        'logs.grep': 'grep logs...',
        'logs.clear': '清空日志',
        'logs.account': '账号',
        'logs.just_now': '刚刚',
        'logs.min_ago': '{n}分前',
        'logs.hour_ago': '{n}小时前',
        'logs.day_ago': '{n}天前',
        'logs.system': '[系统]',
        'logs.poll_status': '轮询运行中，每5秒轮询一次',
        'dash.status_running': '运行中',
        'models.subtitle': '可用模型的实时配额与状态',
        'models.search': '搜索模型...',
        'models.id': '模型',
        'models.accounts_quota': '各账号剩余额度',
        'models.remaining': '剩余',
        'models.total_hint': '各账号单独计算；未接入额度接口时显示 100%',
        'accounts.add': '添加账号',
        'accounts.subtitle': '管理 Codex 账号与授权',
        'accounts.search': '搜索账号...',
        'accounts.oauth_login': '使用 Codex 登录',
        'accounts.name': '名称',
        'accounts.source': '来源',
        'accounts.source_oauth': 'OAuth',
        'accounts.source_manual': '手动',
        'accounts.account_id': 'Account ID',
        'accounts.delete': '删除',
        'accounts.empty': '暂无账号。请使用「使用 Codex 登录」添加账号。',
        'accounts.account_n': '账号 {n}',
        'settings.system_config': '系统配置',
        'settings.tab_interface': '界面',
        'settings.tab_server': '服务器',
        'settings.section_interface': '界面',
        'settings.section_about': '关于',
        'settings.about_desc': 'Codex Pro API · OpenAI 兼容代理',
        'settings.section_apikey': 'API Key',
        'settings.apikey_label': '密钥（可选，仅一个）',
        'settings.apikey_hint': '未设置时不校验；设置后客户端请求须在 Header 中携带 Authorization: Bearer <密钥>，否则返回 401。',
        'settings.apikey_placeholder': '留空表示不校验',
        'settings.save': '保存',
        'settings.saved': '已保存',
        'settings.section_api': 'API 与端点',
        'settings.section_links': '常用链接',
        'settings.copy': '复制',
        'settings.copied': '已复制',
        'settings.model_label': '推荐模型',
        'settings.link_health': '健康检查',
        'settings.link_oauth': '使用 Codex 登录',
        'settings.link_invoke': '调用文档',
        'settings.language': '语言',
        'settings.language_hint': '切换界面显示语言',
        'settings.api_url': 'API 基础地址',
        'settings.api_hint': '在客户端中请填写上述地址（须含 /v1）。',
        'page.invoke': '调用文档',
        'invoke.subtitle': 'API 调用说明与示例',
        'invoke.base_url': '基础地址',
        'invoke.base_url_hint': '在 CLINE、Cursor 等客户端中请填写上述地址（须含 /v1）。',
        'invoke.health_desc': '健康检查，返回服务状态。',
        'invoke.models_desc': '返回可用模型列表（OpenAI 格式）。',
        'invoke.chat_desc': '对话补全，与 OpenAI Chat Completions 兼容，支持 stream。',
        'invoke.curl_win': 'curl (Windows)',
        'invoke.curl_linux': 'curl (Linux / macOS)',
        'invoke.python': 'Python (openai)',
        'invoke.nodejs': 'Node.js (openai)',
        'invoke.chat_multi_turn': '多轮对话示例',
        'invoke.total_quota': '总剩余',
        'modal.add_title': '添加账号',
        'modal.desc': '粘贴 Codex <code>auth.json</code> 内容或上传文件，该账号将参与轮询请求。',
        'modal.paste_tab': '粘贴 JSON',
        'modal.upload_tab': '上传文件',
        'modal.name_optional': '备注名（选填）',
        'modal.name_label': '名称（选填）',
        'modal.table_hint': '添加后在账号列表中显示：名称、来源、Account ID。',
        'modal.name_placeholder': '例如：主号',
        'modal.auth_content': 'auth.json 内容',
        'modal.auth_placeholder': '{"tokens":{"access_token":"...","account_id":"..."}}',
        'modal.select_file': '选择 auth.json 文件',
        'modal.select_file_btn': '选择文件',
        'modal.no_file': '未选择文件',
        'modal.table_hint_html': '添加后在账号列表中显示：<strong>名称</strong>、<strong>来源</strong>、<strong>Account ID</strong>。',
        'modal.or': '或',
        'modal.oauth_hint': '— 跳转至 OpenAI 登录后自动添加账号。',
        'modal.cli_hint': '从 <code>~/.codex/auth.json</code>（Windows：<code>%USERPROFILE%\\.codex\\auth.json</code>）复制内容粘贴到上方。',
        'modal.add_btn': '添加账号',
        'msg.paste_required': '请粘贴 auth.json 内容',
        'msg.invalid_json': 'JSON 格式无效',
        'msg.select_file': '请选择 auth.json 文件',
        'msg.file_invalid': '文件不是有效 JSON',
        'msg.add_failed': '添加失败',
        'msg.add_success': '已添加，下次请求将参与轮询。',
        'msg.request_failed': '请求失败：',
        'msg.oauth_success': '已通过 OAuth 添加账号。',
        'msg.oauth_close_tab': '请关闭此标签页。',
        'msg.oauth_success_title': '登录成功！',
        'msg.oauth_success_hint': '可关闭此标签页或返回主页面刷新账号列表。',
        'msg.oauth_close_btn': '关闭此标签页',
        'msg.oauth_return_btn': '返回主页面',
        'msg.oauth_error': 'OAuth 登录失败：',
        'msg.oauth_error_region': '您所在地区可能无法使用该登录方式。可尝试：使用网络代理（VPN）后重试，或从已登录设备复制 auth.json，在本页「添加账号」里粘贴添加。若已开 VPN 仍报错，请确认浏览器（及登录页）也走代理，或直接使用「粘贴 JSON」添加账号。',
        'footer.violetteam': '推荐使用 free.violetteam.cloud<br>注册 ChatGPT 小号并添加',
        'footer.github': 'GitHub',
      },
      en: {
        'menu.main': 'Main',
        'menu.system': 'System',
        'nav.dashboard': 'Dashboard',
        'nav.models': 'Models',
        'nav.accounts': 'Accounts',
        'nav.invoke': 'Invoke',
        'nav.logs': 'Logs',
        'nav.settings': 'Settings',
        'topbar.subtitle': 'CODEX PROXY SYSTEM v{{version}}',
        'version.proxy': 'Proxy v{{version}}',
        'version.short': 'v{{version}}',
        'topbar.online': 'ONLINE',
        'page.dashboard': 'Dashboard',
        'page.models': 'Models',
        'page.accounts': 'Accounts',
        'page.settings': 'Settings',
        'dash.tag': 'CODEX PROXY SYSTEM',
        'intro.tagline': 'Round-robin · Multi-account · One-click',
        'dash.live': 'LIVE',
        'dash.accounts': 'Accounts',
        'dash.accounts_hint': 'Round-robin enabled',
        'dash.status': 'API Status',
        'dash.request_volume': 'Request Volume',
        'dash.no_data': 'No data tracked yet',
        'dash.quota_chart': 'Used tokens by model',
        'dash.chart_hint': 'By token count; total used tokens across accounts over time',
        'page.logs': 'Logs',
        'logs.empty': 'No logs yet. API request logs will appear here when available.',
        'logs.refresh': 'Refresh',
        'logs.grep': 'grep logs...',
        'logs.clear': 'Clear logs',
        'logs.account': 'Account',
        'logs.just_now': 'Just now',
        'logs.min_ago': '{n} min ago',
        'logs.hour_ago': '{n} hr ago',
        'logs.day_ago': '{n} day ago',
        'logs.system': '[System]',
        'logs.poll_status': 'Round-robin active, polling every 5s',
        'dash.status_running': 'Running',
        'models.subtitle': 'Real-time quota and status for available models',
        'models.search': 'Search models...',
        'models.id': 'Model',
        'models.accounts_quota': 'Accounts & remaining',
        'models.remaining': 'Remaining',
        'models.total_hint': 'Per-account; shows 100% when no quota API',
        'accounts.add': 'Add New Account',
        'accounts.subtitle': 'Manage Codex account tokens and authorization',
        'accounts.search': 'Search accounts...',
        'accounts.oauth_login': 'Login with Codex',
        'accounts.name': 'Name',
        'accounts.source': 'Source',
        'accounts.source_oauth': 'OAuth',
        'accounts.source_manual': 'Manual',
        'accounts.account_id': 'Account ID',
        'accounts.delete': 'Delete',
        'accounts.empty': 'No accounts yet. Use Login with Codex to add an account.',
        'accounts.account_n': 'Account {n}',
        'settings.system_config': 'System Configuration',
        'settings.tab_interface': 'Interface',
        'settings.tab_server': 'Server',
        'settings.section_interface': 'Interface',
        'settings.section_about': 'About',
        'settings.about_desc': 'Codex Pro API · OpenAI-compatible proxy',
        'settings.section_apikey': 'API Key',
        'settings.apikey_label': 'Key (optional, single key only)',
        'settings.apikey_hint': 'When empty, no check; when set, requests must include Header Authorization: Bearer <key>, otherwise 401.',
        'settings.apikey_placeholder': 'Leave empty for no check',
        'settings.save': 'Save',
        'settings.saved': 'Saved',
        'settings.section_api': 'API & Endpoints',
        'settings.section_links': 'Quick Links',
        'settings.copy': 'Copy',
        'settings.copied': 'Copied!',
        'settings.model_label': 'Recommended model',
        'settings.link_health': 'Health check',
        'settings.link_oauth': 'Login with Codex',
        'settings.link_invoke': 'API docs',
        'settings.language': 'Language',
        'settings.language_hint': 'Switch interface language',
        'settings.api_url': 'API Base URL',
        'settings.api_hint': 'Use the URL above (must include /v1) in your client.',
        'page.invoke': 'API Docs',
        'invoke.subtitle': 'API reference and examples',
        'invoke.base_url': 'Base URL',
        'invoke.base_url_hint': 'Use the URL above (must include /v1) in CLINE, Cursor, or other clients.',
        'invoke.health_desc': 'Health check, returns service status.',
        'invoke.models_desc': 'Returns available models list (OpenAI format).',
        'invoke.chat_desc': 'Chat completions, OpenAI-compatible, supports stream.',
        'invoke.curl_win': 'curl (Windows)',
        'invoke.curl_linux': 'curl (Linux / macOS)',
        'invoke.python': 'Python (openai)',
        'invoke.nodejs': 'Node.js (openai)',
        'invoke.chat_multi_turn': 'Multi-turn example',
        'invoke.total_quota': 'Total remaining',
        'modal.add_title': 'Add New Account',
        'modal.desc': 'Paste your Codex <code>auth.json</code> content or upload the file. The account will be used for round-robin API requests.',
        'modal.paste_tab': 'Paste JSON',
        'modal.upload_tab': 'Upload File',
        'modal.name_optional': 'Name (optional)',
        'modal.name_label': 'Name (optional)',
        'modal.table_hint': 'After adding, the list will show: Name, Source, Account ID.',
        'modal.name_placeholder': 'e.g. Main account',
        'modal.auth_content': 'auth.json content',
        'modal.auth_placeholder': '{"tokens":{"access_token":"...","account_id":"..."}}',
        'modal.select_file': 'Select auth.json file',
        'modal.select_file_btn': 'Select file',
        'modal.no_file': 'No file selected',
        'modal.table_hint_html': 'After adding, the list will show: <strong>Name</strong>, <strong>Source</strong>, <strong>Account ID</strong>.',
        'modal.or': 'OR',
        'modal.oauth_hint': '— redirects to OpenAI to sign in, then adds the account automatically.',
        'modal.cli_hint': 'Copy from <code>~/.codex/auth.json</code> (Windows: <code>%USERPROFILE%\\.codex\\auth.json</code>) and paste above.',
        'modal.add_btn': 'Add Account',
        'msg.paste_required': 'Please paste auth.json content.',
        'msg.invalid_json': 'Invalid JSON.',
        'msg.select_file': 'Please select auth.json file.',
        'msg.file_invalid': 'File is not valid JSON.',
        'msg.add_failed': 'Add failed',
        'msg.add_success': 'Account added. Round-robin will use it on next request.',
        'msg.request_failed': 'Request failed: ',
        'msg.oauth_success': 'Account added via OAuth.',
        'msg.oauth_close_tab': 'You may close this tab.',
        'msg.oauth_success_title': 'Login successful!',
        'msg.oauth_success_hint': 'Close this tab or return to the main page to refresh the account list.',
        'msg.oauth_close_btn': 'Close this tab',
        'msg.oauth_return_btn': 'Return to main page',
        'msg.oauth_error': 'OAuth login failed: ',
        'msg.oauth_error_region': 'Your region may not be supported for this login. You can try: use a VPN and retry, or copy auth.json from a device where you are already logged in, then paste it in "Add account" on this page. If VPN is on but it still fails, ensure your browser (and the login page) use the proxy, or add an account via "Paste JSON" instead.',
        'footer.violetteam': 'Recommend: free.violetteam.cloud<br>for ChatGPT accounts',
        'footer.github': 'GitHub',
      },
    };

    let locale = (typeof localStorage !== 'undefined' && localStorage.getItem(STORAGE_LOCALE)) || (navigator.language && navigator.language.startsWith('zh') ? 'zh' : 'en');
    if (!translations[locale]) locale = 'en';

    function t(key) {
      const str = translations[locale] && translations[locale][key];
      const raw = str != null ? str : (translations.en[key] || key);
      const ver = (typeof window !== 'undefined' && window.APP_VERSION) || '';
      return raw.replace(/\{\{version\}\}/g, ver);
    }

    function applyLocale() {
      document.documentElement.lang = locale === 'zh' ? 'zh-CN' : 'en';
      document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        if (key) el.textContent = t(key);
      });
      document.querySelectorAll('[data-i18n-html]').forEach(el => {
        const key = el.getAttribute('data-i18n-html');
        if (key) el.innerHTML = t(key);
      });
      document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
        const key = el.getAttribute('data-i18n-placeholder');
        if (key) el.placeholder = t(key);
      });
      document.querySelectorAll('[data-i18n-title]').forEach(el => {
        const key = el.getAttribute('data-i18n-title');
        if (key) el.title = t(key);
      });
      const sel = document.getElementById('langSelect');
      if (sel) sel.value = locale;
    }

    function showMsg(el, text, type) {
      el.textContent = text;
      el.className = 'msg ' + (type === 'error' ? 'error' : 'success');
      el.style.display = 'block';
      if (type !== 'error') setTimeout(() => { el.style.display = 'none'; }, 3000);
    }

    document.getElementById('langSelect').addEventListener('change', (e) => {
      locale = e.target.value;
      try { localStorage.setItem(STORAGE_LOCALE, locale); } catch (_) {}
      applyLocale();
      setEndpoint();
      loadList();
    });

    function routeTo(view) {
      const id = 'view-' + view;
      const panel = document.getElementById(id);
      if (!panel) return;
      document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
      document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
      const link = document.querySelector('.nav-link[data-view="' + view + '"]');
      if (link) link.classList.add('active');
      panel.classList.add('active');
      if (view === 'dashboard') {
        if (!dashPollTimer) {
          dashPollTimer = setInterval(async function() {
            try {
              var u = await fetch(API + '/api/usage');
              var data = await u.json();
              pushUsageSnapshot(data);
              updateDashboardChart();
            } catch (_) {}
          }, 60000);
        }
        updateDashboardChart();
      } else {
        if (dashPollTimer) { clearInterval(dashPollTimer); dashPollTimer = null; }
      }
      if (location.hash !== '#/' + view) history.replaceState(null, '', '#/' + view);
      if (view === 'logs') loadLogs();
      if (view === 'settings') loadSettings();
    }
    async function loadSettings() {
      try {
        const r = await fetch(API + '/api/settings');
        const data = await r.json();
        const input = document.getElementById('settingsApikeyInput');
        if (input) input.value = data.api_key || '';
      } catch (_) {}
    }
    function bindSettingsApikey() {
      var btn = document.getElementById('btnSaveApikey');
      var input = document.getElementById('settingsApikeyInput');
      if (!btn || !input) return;
      btn.addEventListener('click', async function () {
        var val = (input.value || '').trim();
        try {
          await fetch(API + '/api/settings', {
            method: 'PATCH',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ api_key: val })
          });
          btn.textContent = typeof t === 'function' ? t('settings.saved') : 'Saved';
          setTimeout(function () { btn.textContent = typeof t === 'function' ? t('settings.save') : 'Save'; }, 1500);
        } catch (_) {}
      });
    }
    var _lastLogs = [];
    function relativeTime(isoStr) {
      if (!isoStr) return '';
      var then = new Date(isoStr).getTime();
      var now = Date.now();
      var diffMs = now - then;
      var diffM = Math.floor(diffMs / 60000);
      var diffH = Math.floor(diffMs / 3600000);
      var diffD = Math.floor(diffMs / 86400000);
      if (diffMs < 60000) return t('logs.just_now');
      if (diffM < 60) return t('logs.min_ago').replace('{n}', diffM);
      if (diffH < 24) return t('logs.hour_ago').replace('{n}', diffH);
      return t('logs.day_ago').replace('{n}', diffD);
    }
    function getLogMessage(e) {
      if (e.type === 'system' && e.messageKey) return t(e.messageKey);
      var method = (e.method || '').toUpperCase();
      var path = e.pathKey ? t(e.pathKey) : (e.path || '');
      var status = e.status != null ? String(e.status) : '';
      var ms = e.ms != null ? e.ms + 'ms' : '';
      var msg = '[' + method + '] ' + path + (status ? ' ' + status : '') + (ms ? ' (' + ms + ')' : '');
      if (e.account) msg += ' ' + e.account;
      return msg;
    }
    function logTimeHMS(isoStr) {
      if (!isoStr) return '--:--:--';
      var d = new Date(isoStr);
      var h = d.getHours(), m = d.getMinutes(), s = d.getSeconds();
      return (h < 10 ? '0' : '') + h + ':' + (m < 10 ? '0' : '') + m + ':' + (s < 10 ? '0' : '') + s;
    }
    function renderLogs(logs) {
      const placeholder = document.getElementById('logsPlaceholder');
      const listEl = document.getElementById('logsList');
      if (!listEl || !placeholder) return;
      var infoOk = document.getElementById('logFilterInfo') && document.getElementById('logFilterInfo').checked;
      var successOk = document.getElementById('logFilterSuccess') && document.getElementById('logFilterSuccess').checked;
      var warnOk = document.getElementById('logFilterWarn') && document.getElementById('logFilterWarn').checked;
      var errOk = document.getElementById('logFilterErr') && document.getElementById('logFilterErr').checked;
      const q = (document.getElementById('logsSearch') && document.getElementById('logsSearch').value || '').toLowerCase();
      var filtered = logs.filter(function (e) {
        var level = (e.level || (e.type === 'system' ? 'INFO' : (e.status >= 500 ? 'ERR' : e.status >= 400 ? 'WARN' : 'SUCCESS'))).toUpperCase();
        if (level === 'INFO' && !infoOk) return false;
        if (level === 'SUCCESS' && !successOk) return false;
        if (level === 'WARN' && !warnOk) return false;
        if (level === 'ERR' && !errOk) return false;
        if (q) {
          var text = (getLogMessage(e) + ' ' + (e.path || '') + ' ' + (e.account || '')).toLowerCase();
          if (text.indexOf(q) === -1) return false;
        }
        return true;
      });
      var countEl = document.getElementById('logsCount');
      if (countEl) countEl.textContent = filtered.length + '/' + logs.length;
      listEl.innerHTML = filtered.map(function (e) {
        var level = e.level || (e.type === 'system' ? 'INFO' : (e.status >= 500 ? 'ERR' : e.status >= 400 ? 'WARN' : 'SUCCESS'));
        level = level.toUpperCase();
        var timeStr = logTimeHMS(e.time);
        var msg = escapeHtml(getLogMessage(e));
        return '<div class="log-entry" data-level="' + level.toLowerCase() + '"><span class="log-time">' + escapeHtml(timeStr) + '</span><span class="log-level"><span class="log-badge ' + level.toLowerCase() + '">' + level + '</span></span><span class="log-msg">' + msg + '</span></div>';
      }).join('');
      placeholder.style.display = logs.length === 0 ? 'block' : 'none';
      listEl.style.display = logs.length === 0 ? 'none' : 'block';
    }
    async function loadLogs() {
      try {
        const r = await fetch(API + '/api/logs');
        const data = await r.json();
        _lastLogs = data.logs || [];
        renderLogs(_lastLogs);
      } catch (_) {}
    }
    async function clearLogs() {
      try {
        await fetch(API + '/api/logs', { method: 'DELETE' });
        _lastLogs = [];
        renderLogs(_lastLogs);
        loadLogs();
      } catch (_) {}
    }
    function routeFromHash() {
      const hash = (location.hash || '#/').replace(/^#\/?/, '') || 'dashboard';
      const allowed = ['dashboard', 'models', 'accounts', 'invoke', 'logs', 'settings'];
      const view = allowed.indexOf(hash) !== -1 ? hash : 'dashboard';
      routeTo(view);
    }
    window.addEventListener('hashchange', routeFromHash);
    function closeSidebar() { document.body.classList.remove('sidebar-open'); }
    document.getElementById('btnSidebarToggle') && document.getElementById('btnSidebarToggle').addEventListener('click', function () { document.body.classList.toggle('sidebar-open'); });
    document.getElementById('sidebarOverlay') && document.getElementById('sidebarOverlay').addEventListener('click', closeSidebar);
    document.querySelectorAll('.nav-link').forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        closeSidebar();
        const view = link.dataset.view;
        if (view) routeTo(view);
      });
    });

    async function loadList() {
      const r = await fetch(API + '/api/accounts');
      const data = await r.json();
      const list = data.accounts || [];
      let usageData = { accounts: [] };
      try {
        const u = await fetch(API + '/api/usage');
        usageData = await u.json();
      } catch (_) {}
      const tbody = document.getElementById('accountList');
      const emptyTip = document.getElementById('emptyTip');
      document.getElementById('dash-account-count').textContent = list.length;
      document.getElementById('accountsCount').textContent = list.length;
      loadModelsTable(list, usageData);
      pushUsageSnapshot(usageData);
      updateDashboardChart();
      tbody.innerHTML = '';
      if (list.length === 0) {
        emptyTip.style.display = 'block';
        filterAccounts();
        return;
      }
      emptyTip.style.display = 'none';
      list.forEach((acc, i) => {
        const tr = document.createElement('tr');
        tr.dataset.name = (acc.name || t('accounts.account_n').replace('{n}', i + 1)).toLowerCase();
        tr.dataset.id = (acc.accountIdMask || '').toLowerCase();
        const sourceKey = (acc.source === 'oauth') ? 'accounts.source_oauth' : 'accounts.source_manual';
        const sourceClass = (acc.source === 'oauth') ? 'badge-oauth' : 'badge-manual';
        tr.innerHTML = '<td>' + (acc.name || t('accounts.account_n').replace('{n}', i + 1)) + '</td><td><span class="badge ' + sourceClass + '" data-i18n="' + sourceKey + '">' + t(sourceKey) + '</span></td><td style="color:var(--text-muted);font-size:13px">' + (acc.accountIdMask || '') + '</td><td><button type="button" class="btn-sm" data-index="' + i + '" data-i18n="accounts.delete">' + t('accounts.delete') + '</button></td>';
        tbody.appendChild(tr);
      });
      document.getElementById('accountsCount').textContent = list.length;
      filterAccounts();
      tbody.querySelectorAll('.btn-sm').forEach(b => {
        b.addEventListener('click', async () => {
          await fetch(API + '/api/accounts/' + b.dataset.index, { method: 'DELETE' });
          loadList();
        });
      });
    }

    (function initAddAccountModal() {
      var overlay = document.getElementById('addAccountModalOverlay');
      var btnOpen = document.getElementById('btnAddAccount');
      var btnClose = document.getElementById('addAccountModalClose');
      var btnSubmit = document.getElementById('addAccountSubmit');
      var authText = document.getElementById('addAccountAuthText');
      var nameInput = document.getElementById('addAccountName');
      var fileInput = document.getElementById('addAccountFile');
      var fileBtn = document.getElementById('addAccountFileBtn');
      var fileNameEl = document.getElementById('addAccountFileName');
      if (!overlay || !btnOpen) return;
      function openModal() {
        overlay.classList.add('open');
        overlay.setAttribute('aria-hidden', 'false');
        authText.value = '';
        nameInput.value = '';
        fileInput.value = '';
        if (fileNameEl) {
          fileNameEl.textContent = typeof t === 'function' ? t('modal.no_file') : 'No file selected';
          fileNameEl.classList.remove('has-file');
        }
        document.querySelectorAll('#addAccountModalOverlay .modal-tab').forEach(function (tb) {
          tb.classList.toggle('active', tb.dataset.tab === 'paste');
        });
        document.getElementById('addAccountPanelPaste').classList.add('active');
        document.getElementById('addAccountPanelUpload').classList.remove('active');
      }
      function closeModal() {
        overlay.classList.remove('open');
        overlay.setAttribute('aria-hidden', 'true');
      }
      btnOpen.addEventListener('click', openModal);
      btnClose.addEventListener('click', closeModal);
      overlay.addEventListener('click', function (e) { if (e.target === overlay) closeModal(); });
      document.querySelectorAll('#addAccountModalOverlay .modal-tab').forEach(function (tb) {
        tb.addEventListener('click', function () {
          var tab = tb.dataset.tab;
          document.querySelectorAll('#addAccountModalOverlay .modal-tab').forEach(function (t) { t.classList.toggle('active', t.dataset.tab === tab); });
          document.getElementById('addAccountPanelPaste').classList.toggle('active', tab === 'paste');
          document.getElementById('addAccountPanelUpload').classList.toggle('active', tab === 'upload');
        });
      });
      if (fileBtn && fileInput) fileBtn.addEventListener('click', function () { fileInput.click(); });
      fileInput.addEventListener('change', function () {
        var f = fileInput.files && fileInput.files[0];
        if (fileNameEl) {
          fileNameEl.textContent = f ? f.name : (typeof t === 'function' ? t('modal.no_file') : 'No file selected');
          fileNameEl.classList.toggle('has-file', !!f);
        }
        if (!f) return;
        var r = new FileReader();
        r.onload = function () { authText.value = r.result || ''; };
        r.readAsText(f);
      });
      btnSubmit.addEventListener('click', async function () {
        var jsonStr = (authText.value || '').trim();
        if (!jsonStr) {
          alert(typeof t === 'function' ? t('msg.paste_required') : 'Please paste auth.json content.');
          return;
        }
        try {
          JSON.parse(jsonStr);
        } catch (e) {
          alert((typeof t === 'function' ? t('msg.invalid_json') : 'Invalid JSON.') + ' ' + (e.message || ''));
          return;
        }
        var name = (nameInput.value || '').trim() || undefined;
        var res = await fetch(API + '/api/accounts', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ authJson: jsonStr, name: name })
        });
        var data = await res.json().catch(function () { return {}; });
        if (res.ok && data.ok) {
          closeModal();
          loadList();
          if (typeof t === 'function') { var banner = document.getElementById('oauthBanner'); if (banner) { banner.textContent = t('msg.add_success'); banner.className = 'oauth-banner success'; banner.style.display = 'block'; setTimeout(function () { banner.style.display = 'none'; }, 4000); } }
        } else {
          alert((typeof t === 'function' ? t('msg.add_failed') : 'Add failed') + (data.error ? ': ' + data.error : ''));
        }
      });
    })();

    function setEndpoint() {
      const origin = location.origin;
      const apiBase = origin + '/v1';
      document.getElementById('dash-endpoint').textContent = origin;
      document.getElementById('settings-baseurl').textContent = apiBase;
      const docBase = document.getElementById('docBaseUrl');
      if (docBase) docBase.textContent = apiBase;
      var port = location.port || (location.protocol === 'https:' ? '443' : '80');
      if (port === '80' || port === '443') port = '1455';
      var baseOrigin = location.origin || ('http://localhost:' + port);
      var loginUrl = baseOrigin + '/auth/login';
      var oauthBtn = document.getElementById('oauthLoginBtn');
      if (oauthBtn) {
        oauthBtn.href = loginUrl;
        oauthBtn.addEventListener('click', function (e) {
          e.preventDefault();
          window.open(loginUrl, 'codex_oauth', 'width=520,height=640,scrollbars=yes,resizable=yes');
        });
      }
      var settingsOAuthLink = document.getElementById('settingsLinkOAuth');
      if (settingsOAuthLink) {
        settingsOAuthLink.href = loginUrl;
        settingsOAuthLink.addEventListener('click', function (e) {
          e.preventDefault();
          window.open(loginUrl, 'codex_oauth', 'width=520,height=640,scrollbars=yes,resizable=yes');
        });
      }
      var btnCopy = document.getElementById('btnCopyApiUrl');
      if (btnCopy) {
        btnCopy.addEventListener('click', function () {
          var el = document.getElementById('settings-baseurl');
          var url = (el && el.textContent) ? el.textContent.trim() : '';
          if (url && navigator.clipboard && navigator.clipboard.writeText) {
            navigator.clipboard.writeText(url).then(function () {
              var orig = btnCopy.textContent;
              btnCopy.textContent = (typeof t === 'function' ? t('settings.copied') : 'Copied!');
              setTimeout(function () { btnCopy.textContent = (typeof t === 'function' ? t('settings.copy') : orig); }, 1500);
            });
          }
        });
      }
      renderInvokeCommands(origin, apiBase);
      bindSettingsApikey();
    }
    function renderInvokeCommands(origin, apiBase) {
      if (!apiBase) apiBase = origin + '/v1';
      const health = origin + '/health';
      const modelsUrl = apiBase + '/models';
      const chatUrl = apiBase + '/chat/completions';
      const chatBodyWin = '{\\"model\\": \\"gpt-5.3-codex\\", \\"messages\\": [{\\"role\\": \\"user\\", \\"content\\": \\"Hello\\"}]}';
      const chatBodyLinux = '{"model": "gpt-5.3-codex", "messages": [{"role": "user", "content": "Hello"}]}';
      function block(labelKey, rawCode, lang) {
        const code = escapeHtml(rawCode);
        return '<div class="doc-cmd-block"><div class="doc-cmd-label" data-i18n="' + labelKey + '">' + t(labelKey) + '</div><pre class="doc-pre language-' + lang + '"><code class="language-' + lang + '">' + code + '</code></pre></div>';
      }
      const healthCmds = document.getElementById('docHealthCmds');
      if (healthCmds) {
        healthCmds.innerHTML =
          block('invoke.curl_win', 'curl -X GET "' + health + '"', 'bash') +
          block('invoke.curl_linux', "curl -X GET '" + health + "'", 'bash') +
          block('invoke.python', 'import requests\n\nr = requests.get("' + health + '")\nprint(r.json())', 'python') +
          block('invoke.nodejs', 'const res = await fetch("' + health + '");\nconst data = await res.json();\nconsole.log(data);', 'javascript');
      }
      const modelsCmds = document.getElementById('docModelsCmds');
      if (modelsCmds) {
        modelsCmds.innerHTML =
          block('invoke.curl_win', 'curl -X GET "' + modelsUrl + '"', 'bash') +
          block('invoke.curl_linux', "curl -X GET '" + modelsUrl + "'", 'bash') +
          block('invoke.python', 'from openai import OpenAI\n\nclient = OpenAI(\n    base_url="' + apiBase + '",\n    api_key="sk-"\n)\nfor m in client.models.list():\n    print(m)', 'python') +
          block('invoke.nodejs', 'import OpenAI from "openai";\n\nconst client = new OpenAI({\n  baseURL: "' + apiBase + '",\n  apiKey: "sk-"\n});\nconst list = await client.models.list();\nconsole.log(list.data);', 'javascript');
      }
      const chatCmds = document.getElementById('docChatCmds');
      if (chatCmds) {
        const multiTurnPy = 'from openai import OpenAI\n\nclient = OpenAI(base_url="' + apiBase + '", api_key="sk-")\nr = client.chat.completions.create(\n    model="gpt-5.3-codex",\n    messages=[\n        {"role": "user", "content": "记住这个数字：42"},\n        {"role": "assistant", "content": "好的，我记住了 42。"},\n        {"role": "user", "content": "我刚刚让你记住的数字是多少？只回答数字。"}\n    ]\n)\nprint(r.choices[0].message.content)';
        chatCmds.innerHTML =
          block('invoke.curl_win', 'curl -X POST "' + chatUrl + '" ^\n  -H "Content-Type: application/json" ^\n  -d "' + chatBodyWin + '"', 'bash') +
          block('invoke.curl_linux', "curl -X POST '" + chatUrl + "' \\\n  -H 'Content-Type: application/json' \\\n  -d '" + chatBodyLinux + "'", 'bash') +
          block('invoke.python', 'from openai import OpenAI\n\nclient = OpenAI(\n    base_url="' + apiBase + '",\n    api_key="sk-"\n)\nr = client.chat.completions.create(\n    model="gpt-5.3-codex",\n    messages=[{"role": "user", "content": "Hello"}]\n)\nprint(r)', 'python') +
          block('invoke.nodejs', 'import OpenAI from "openai";\n\nconst client = new OpenAI({\n  baseURL: "' + apiBase + '",\n  apiKey: "sk-"\n});\nconst r = await client.chat.completions.create({\n  model: "gpt-5.3-codex",\n  messages: [{ role: "user", content: "Hello" }]\n});\nconsole.log(r);', 'javascript') +
          '<div class="doc-section" style="margin-top:24px"><h3 class="doc-h2" data-i18n="invoke.chat_multi_turn">' + (t('invoke.chat_multi_turn') || '多轮对话示例') + '</h3><div class="doc-cmd-block"><pre class="doc-pre language-python"><code class="language-python">' + escapeHtml(multiTurnPy) + '</code></pre></div></div>';
      }
      if (typeof Prism !== 'undefined') {
        document.querySelectorAll('#invokeDocContent pre code[class*="language-"]').forEach(function (el) { if (window.Prism && typeof Prism.highlightElement === 'function') Prism.highlightElement(el); });
      }
    }
    document.getElementById('invokeNav') && document.getElementById('invokeNav').addEventListener('click', function (e) {
      var btn = e.target.closest('.invoke-nav-btn');
      if (!btn || !btn.dataset.invoke) return;
      document.querySelectorAll('.invoke-nav-btn').forEach(function (b) { b.classList.remove('active'); });
      document.querySelectorAll('.invoke-panel').forEach(function (p) { p.classList.remove('active'); });
      btn.classList.add('active');
      var panel = document.getElementById('invoke-panel-' + btn.dataset.invoke);
      if (panel) panel.classList.add('active');
    });

    function handleOAuthReturn() {
      const params = new URLSearchParams(location.search);
      const oauth = params.get('oauth');
      const msg = params.get('msg');
      if (!oauth) return;
      const banner = document.getElementById('oauthBanner');
      if (oauth === 'success') {
        routeTo('accounts');
        loadList();
        if (window.opener) {
          try { window.opener.postMessage('codex_oauth_success', location.origin); } catch (_) {}
          if (window.opener.focus) window.opener.focus();
          window.close();
        } else {
          banner.textContent = t('msg.oauth_success');
          banner.className = 'oauth-banner success';
          banner.style.display = 'block';
          setTimeout(function () { banner.style.display = 'none'; }, 5000);
        }
      } else if (oauth === 'error') {
        var decodedMsg = msg ? decodeURIComponent(msg) : '';
        var isRegionRelated = /access_denied|region|country|restrict|not available|unsupported|blocked|geo|location|not supported|denied/i.test(decodedMsg);
        banner.textContent = t('msg.oauth_error') + decodedMsg + (isRegionRelated ? '\n\n' + t('msg.oauth_error_region') : '');
        banner.className = 'oauth-banner error';
        banner.style.display = 'block';
      }
      history.replaceState(null, '', location.pathname || '/');
      loadList();
    }

    function updateDashboardTime() {
      const el = document.getElementById('dashTime');
      if (el) el.textContent = new Date().toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
    }
    setInterval(updateDashboardTime, 1000);
    updateDashboardTime();

    document.getElementById('btnRefresh').addEventListener('click', () => { loadList(); setEndpoint(); });

    document.getElementById('btnReloadAccounts').addEventListener('click', () => loadList());
    document.getElementById('btnRefreshLogs') && document.getElementById('btnRefreshLogs').addEventListener('click', () => loadLogs());
    function onLogsFilterChange() { if (_lastLogs.length) renderLogs(_lastLogs); }
    document.getElementById('logsSearch') && document.getElementById('logsSearch').addEventListener('input', onLogsFilterChange);
    ['logFilterInfo','logFilterSuccess','logFilterWarn','logFilterErr'].forEach(function(id) {
      var el = document.getElementById(id);
      if (el) el.addEventListener('change', onLogsFilterChange);
    });
    document.getElementById('btnClearLogs') && document.getElementById('btnClearLogs').addEventListener('click', function() { clearLogs(); });

    function loadModelsTable(accounts, usage) {
      const tbody = document.getElementById('modelsTableBody');
      if (!tbody) return;
      const list = accounts || [];
      const usageList = (usage && usage.accounts) ? usage.accounts : [];
      const getPct = (i) => {
        const u = usageList.find(function(a) { return a.index === i; });
        return (u && u.remaining_pct != null) ? u.remaining_pct : 100;
      };
      const getUsed = (i) => {
        const u = usageList.find(function(a) { return a.index === i; });
        return (u && typeof u.used_tokens === 'number') ? u.used_tokens : null;
      };
      const fmtTokens = (n) => n == null ? '' : (n >= 1000000 ? (n / 1000000).toFixed(1) + 'M' : n.toLocaleString());
      tbody.innerHTML = MODEL_IDS.map(modelId => {
        const accountList = list.length ? list.map((acc, i) => {
          const pct = getPct(i);
          const used = getUsed(i);
          const name = acc.name || t('accounts.account_n').replace('{n}', i + 1);
          const fillClass = pct <= 0 ? 'empty' : (pct <= 25 ? 'low' : '');
          const usedStr = used != null ? (locale === 'zh' ? '已用 ' + fmtTokens(used) + ' token' : fmtTokens(used) + ' tokens used') : '';
          const usedHtml = usedStr ? '<span class="models-account-used">' + escapeHtml(usedStr) + '</span>' : '';
          return '<div class="models-account-row"><div class="models-account-info"><span class="models-account-name">' + escapeHtml(name) + '</span>' + usedHtml + '</div><div class="quota-bar-wrap"><div class="quota-bar"><div class="quota-fill ' + fillClass + '" style="width:' + pct + '%"></div></div></div><span class="models-account-quota">' + pct + '%</span></div>';
        }).join('') : '<div class="models-account-row" style="color:var(--text-muted);">' + (locale === 'zh' ? '暂无账号' : 'No accounts') + '</div>';
        return '<tr data-model="' + escapeHtml(modelId) + '"><td class="field-highlight">' + escapeHtml(modelId) + '</td><td class="field-highlight">' + accountList + '</td></tr>';
      }).join('');
      const totalCard = document.getElementById('modelsQuotaTotal');
      const totalVal = document.getElementById('modelsTotalQuotaValue');
      if (totalCard && totalVal) {
        const totalBar = document.getElementById('modelsTotalQuotaBar');
        const pcts = list.map(function(_, i) { return getPct(i); });
        const hasReal = pcts.some(function(p) { return p !== 100; });
        const totalPct = list.length ? (hasReal ? Math.min.apply(null, pcts) : 100) : null;
        if (totalBar) {
          totalBar.style.width = list.length ? (totalPct != null ? totalPct + '%' : '100%') : '0';
          totalBar.classList.toggle('low', totalPct != null && totalPct <= 25);
          totalBar.classList.toggle('empty', !list.length || (totalPct != null && totalPct <= 0));
        }
        totalVal.textContent = list.length ? (totalPct != null ? totalPct + '%' : '100%') : '—';
      }
    }
    function escapeHtml(s) {
      const div = document.createElement('div');
      div.textContent = s;
      return div.innerHTML;
    }
    document.getElementById('modelsSearch').addEventListener('input', filterModels);
    function filterModels() {
      const q = (document.getElementById('modelsSearch').value || '').toLowerCase();
      document.querySelectorAll('#modelsTable tbody tr').forEach(tr => {
        const model = (tr.dataset.model || '').toLowerCase();
        tr.style.display = (!q || model.indexOf(q) !== -1) ? '' : 'none';
      });
    }

    document.getElementById('accountsSearch').addEventListener('input', filterAccounts);
    function filterAccounts() {
      const q = (document.getElementById('accountsSearch').value || '').toLowerCase();
      document.querySelectorAll('#accountList tr').forEach(tr => {
        const name = tr.dataset.name || '';
        const id = tr.dataset.id || '';
        tr.style.display = (!q || name.indexOf(q) !== -1 || id.indexOf(q) !== -1) ? '' : 'none';
      });
    }

    document.querySelectorAll('.settings-tab').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.settings-tab').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.settings-panel').forEach(p => p.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById('settings-' + btn.dataset.tab).classList.add('active');
      });
    });

    window.addEventListener('message', function (e) {
      if (e.origin !== location.origin || e.data !== 'codex_oauth_success') return;
      routeTo('accounts');
      loadList();
    });

    fetch('/api/version').then(r => r.json()).then(d => { window.APP_VERSION = d.version || ''; applyLocale(); }).catch(() => { window.APP_VERSION = ''; applyLocale(); });
    setEndpoint();
    loadList();
    handleOAuthReturn();
    routeFromHash();

    setInterval(function () {
      loadList();
      loadLogs();
    }, 5000);
  </script>
</body>
</html>
